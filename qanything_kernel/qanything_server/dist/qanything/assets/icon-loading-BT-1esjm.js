import{u as I,g as H,r as k,f as j,c as z}from"./utils-CXxq_1WL.js";import{x as E,r as a,R as D,z as J,N as _,A as G,B as S,aR as W}from"./index-uS7D60Vj.js";import{g as T}from"./index-BtipXdVs.js";const re=s=>!isNaN(parseFloat(s))&&isFinite(s);var X=(s=>(s[s.success=0]="success",s[s.parsed=1]="parsed",s[s.error=2]="error",s[s.filebig=3]="filebig",s[s.loading=4]="loading",s[s.failed=5]="failed",s))(X||{}),F=(s=>(s[s.initing=0]="initing",s[s.default=1]="default",s[s.normal=2]="normal",s[s.optionlist=3]="optionlist",s))(F||{});const $=T().common,ee=E("knowledgeBase",()=>{const s=a(""),v=n=>{s.value=n},r=a([]),B=n=>{r.value=n},A=a(""),h=n=>{A.value=n},w=a([]),b=n=>{w.value=n},u=a(F.initing),g=n=>{u.value=n},f=a(!1);return{currentId:s,setCurrentId:v,knowledgeBaseList:w,setKnowledgeBaseList:b,showDeleteModal:f,setShowDeleteModal:n=>{f.value=n},showDefault:u,setDefault:g,getList:async()=>{var n;try{const l=await I.kbList();if(+l.code==200)if(((n=l==null?void 0:l.data)==null?void 0:n.length)>0){const c=l.data.filter(p=>!/.*_FAQ$/.test(p.kb_name));b(c),g(F.normal),r.value.length||r.value.push(c[0].kb_id)}else g(F.default)}catch(l){D.error(l.msg||$.error)}},currentKbName:A,setCurrentKbName:h,selectList:r,setSelectList:B}}),K=T().home,se=T().common,ie=E("knowledgeModal",()=>{const s=a(!1),v=l=>{s.value=l},r=a(!1),B=l=>{r.value=l},A=a(K.upload),h=l=>{A.value=l},w=a(""),b=l=>{w.value=l},u=a([]),g=l=>{u.value=l},f=a([]);return{modalVisible:s,setModalVisible:v,urlModalVisible:r,setUrlModalVisible:B,knowledgeName:w,setKnowledgeName:b,fileList:u,setFileList:g,urlList:f,setUrlList:l=>{f.value=l},modalTitle:A,setModalTitle:h,$reset:()=>{s.value=!1,A.value=K.upload,w.value="",u.value=[],f.value=[]},getFileList:async l=>{try{const c=await I.fileList({kb_id:l});c.code==200&&(c.data.details.forEach(p=>{p.errorText=H(p)}),g(c.data.details))}catch(c){console.log(c),D.error(c.msg||se.error)}}}}),{currentId:R}=J(ee()),ue=E("option-list",()=>{const s=a([]),v=e=>{s.value=e},r=a({green:0,gray:0,yellow:0,red:0}),B=a(0),A=e=>{B.value=e},h=a(1),w=e=>{h.value=e},b=a(10),u=a([]),g=e=>{u.value=e},f=a(0),m=e=>{f.value=e},L=a(1),n=e=>{L.value=e},l=a(!1),c=e=>{l.value=e},p=a("upload"),V=e=>{p.value=e},M=a(null),Y=e=>{M.value=e},x=a(!1),P=e=>{x.value=e},U=a(null),O=async()=>{U.value&&clearTimeout(U.value);const e=await k(await I.fileList({kb_id:R.value,page_offset:h.value,page_limit:b.value}));Object.keys(r.value).forEach(o=>{r.value[o]=0}),Object.assign(r.value,e.status_count),v([]),A(e.total);const N=(o="",d="green")=>{if(d!=="green")return o;const i=JSON.parse(o.toString());return delete i.msg,i};e==null||e.details.forEach((o,d)=>{s.value.push({id:1e4+d,fileId:o==null?void 0:o.file_id,fileIdName:o==null?void 0:o.file_name,status:o==null?void 0:o.status,bytes:j((o==null?void 0:o.bytes)||0),createtime:z(o==null?void 0:o.timestamp),remark:(o==null?void 0:o.status)==="gray"?"":N(o==null?void 0:o.msg,o==null?void 0:o.status)})}),(e==null?void 0:e.details.some(o=>o.status==="gray"||o.status==="yellow"))?(console.log("有解析中的  5后再次请求"),U.value=setTimeout(()=>{clearTimeout(U.value),O()},5e3)):console.log("全部解析完成")},C=a(null),Q=async()=>{try{C.value&&clearTimeout(C.value),c(!0);const e=await k(await I.fileList({kb_id:R.value+"_FAQ"}));if(g([]),!(e!=null&&e.details)){m(0),c(!1);return}for(const t of e==null?void 0:e.details){const o=e==null?void 0:e.details.indexOf(t);u.value.push({id:1e4+o,faqId:t==null?void 0:t.file_id,question:t==null?void 0:t.question,answer:t==null?void 0:t.answer,status:t==null?void 0:t.status,bytes:`${t==null?void 0:t.content_length}字符`,createtime:z(t==null?void 0:t.timestamp),picUrlList:[]}),t!=null&&t.picUrlList&&await Z(t==null?void 0:t.picUrlList).then(d=>{console.log("成功获取图片文件:",d),u.value[o].picUrlList=t==null?void 0:t.picUrlList.map((i,y)=>({uid:-y,name:"image",status:"done",url:i,originFileObj:d[y]}))}).catch(d=>{console.error("获取图片文件出错:",d)})}(e==null?void 0:e.details.some(t=>t.status==="gray"||t.status==="yellow"))?(console.log("有解析中的  5s后再次请求"),C.value=setTimeout(()=>{clearTimeout(C.value),Q()},5e3)):console.log("全部解析完成")}catch(e){console.log(e),D.error(e.msg||"获取faq列表失败")}c(!1)};function Z(e){const N=e.map(t=>new Promise((o,d)=>{fetch(t).then(i=>i.blob()).then(i=>{const y=t.substring(t.lastIndexOf("/")+1),q=new File([i],y,{type:i.type});o(q)}).catch(i=>{console.error("Error fetching the image:",i),d(i)})}));return Promise.all(N)}return{dataSource:s,setDataSource:v,faqList:u,setFaqList:g,getDetails:O,timer:U,editQaSet:M,setEditQaSet:Y,editModalVisible:x,setEditModalVisible:P,faqTimer:C,getFaqList:Q,faqType:p,setFaqType:V,total:f,setTotal:m,pageNum:L,setPageNum:n,loading:l,setLoading:c,totalStatus:r,kbTotal:B,kbPageSize:b,kbPageNum:h,setKbPageNum:w}},{persist:{storage:sessionStorage}}),oe={},te={class:""};function ae(s,v){return G(),S("div",te,[W(s.$slots,"default",{},void 0,!0)])}const de=_(oe,[["render",ae],["__scopeId","data-v-629ddaa7"]]),ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC";export{de as U,ge as _,ie as a,ue as b,X as f,re as i,F as p,ee as u};
