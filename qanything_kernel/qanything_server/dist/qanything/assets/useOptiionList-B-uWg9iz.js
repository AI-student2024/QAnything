import{u as y,g as R,r as z,f as Z,c as V}from"./utils-CVRX5_sX.js";import{x as N,r as l,R as D,z as q}from"./index-DE5jAo-5.js";import{g as T}from"./index-6oUtbOQt.js";var H=(o=>(o[o.success=0]="success",o[o.parsed=1]="parsed",o[o.error=2]="error",o[o.filebig=3]="filebig",o[o.loading=4]="loading",o[o.failed=5]="failed",o))(H||{}),F=(o=>(o[o.initing=0]="initing",o[o.default=1]="default",o[o.normal=2]="normal",o[o.optionlist=3]="optionlist",o))(F||{});const P=T().common,k=N("knowledgeBase",()=>{const o=l(""),v=t=>{o.value=t},n=l([]),h=t=>{n.value=t},d=l(""),B=t=>{d.value=t},g=l([]),C=t=>{g.value=t},i=l(F.initing),r=t=>{i.value=t},f=l(!1);return{currentId:o,setCurrentId:v,knowledgeBaseList:g,setKnowledgeBaseList:C,showDeleteModal:f,setShowDeleteModal:t=>{f.value=t},showDefault:i,setDefault:r,getList:async()=>{var t;try{const a=await y.kbList();if(+a.code==200)if(((t=a==null?void 0:a.data)==null?void 0:t.length)>0){const c=a.data.filter(u=>!/.*_FAQ$/.test(u.kb_name));C(c),r(F.normal),n.value.length||n.value.push(c[0].kb_id)}else r(F.default)}catch(a){D.error(a.msg||P.error)}},currentKbName:d,setCurrentKbName:B,selectList:n,setSelectList:h}}),Y=T().home,J=T().common,X=N("knowledgeModal",()=>{const o=l(!1),v=a=>{o.value=a},n=l(!1),h=a=>{n.value=a},d=l(Y.upload),B=a=>{d.value=a},g=l(""),C=a=>{g.value=a},i=l([]),r=a=>{i.value=a},f=l([]);return{modalVisible:o,setModalVisible:v,urlModalVisible:n,setUrlModalVisible:h,knowledgeName:g,setKnowledgeName:C,fileList:i,setFileList:r,urlList:f,setUrlList:a=>{f.value=a},modalTitle:d,setModalTitle:B,$reset:()=>{o.value=!1,d.value=Y.upload,g.value="",i.value=[],f.value=[]},getFileList:async a=>{try{const c=await y.fileList({kb_id:a});c.code==200&&(c.data.details.forEach(u=>{u.errorText=R(u)}),r(c.data.details))}catch(c){console.log(c),D.error(c.msg||J.error)}}}}),S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",{currentId:K}=q(k()),m=N("option-list",()=>{const o=l([]),v=e=>{o.value=e},n=l([]),h=e=>{n.value=e},d=l(0),B=e=>{d.value=e},g=l(1),C=e=>{g.value=e},i=l(!1),r=e=>{i.value=e},f=l("upload"),E=e=>{f.value=e},L=l(null),t=e=>{L.value=e},a=l(!1),c=e=>{a.value=e},u=l(null),Q=async()=>{try{u.value&&clearTimeout(u.value);const e=await z(await y.fileList({kb_id:K.value}));v([]),e==null||e.details.forEach((s,U)=>{o.value.push({id:1e4+U,fileId:s==null?void 0:s.file_id,fileIdName:s==null?void 0:s.file_name,status:s==null?void 0:s.status,bytes:Z((s==null?void 0:s.bytes)||0),createtime:V(s==null?void 0:s.timestamp),errortext:(s==null?void 0:s.status)==="gray"||(s==null?void 0:s.status)==="green"?"":s==null?void 0:s.msg})});const w=e==null?void 0:e.details.some(s=>s.status==="gray");console.log(w),w?(console.log("有解析中的  5后再次请求"),u.value=setTimeout(()=>{clearTimeout(u.value),Q()},5e3)):console.log("全部解析完成")}catch(e){console.log(e),D.error(e.msg||"获取知识库详情失败")}},p=l(null),x=async()=>{try{p.value&&clearTimeout(p.value),r(!0);const e=await z(await y.fileList({kb_id:K.value+"_FAQ"}));if(h([]),!(e!=null&&e.details)){B(0),r(!1);return}e==null||e.details.forEach(async(s,U)=>{n.value.push({id:1e4+U,faqId:s==null?void 0:s.file_id,question:s==null?void 0:s.question,answer:s==null?void 0:s.answer,status:s==null?void 0:s.status,bytes:`${s==null?void 0:s.content_length}字符`,createtime:V(s==null?void 0:s.timestamp),picUrlList:[]}),s!=null&&s.picUrlList&&await O(s==null?void 0:s.picUrlList).then(b=>{console.log("成功获取图片文件:",b);const A=s==null?void 0:s.picUrlList.map((M,I)=>({uid:-I,name:"image",status:"done",url:M,originFileObj:b[I]}));n.value[U].picUrlList=A}).catch(b=>{console.error("获取图片文件出错:",b)})});const w=e==null?void 0:e.details.some(s=>s.status==="gray");console.log("flag",w),w?(console.log("有解析中的  5s后再次请求"),p.value=setTimeout(()=>{clearTimeout(p.value),x()},5e3)):console.log("全部解析完成")}catch(e){console.log(e),D.error(e.msg||"获取faq列表失败")}r(!1)};function O(e){const w=e.map(s=>new Promise((U,b)=>{fetch(s).then(A=>A.blob()).then(A=>{const M=s.substring(s.lastIndexOf("/")+1),I=new File([A],M,{type:A.type});U(I)}).catch(A=>{console.error("Error fetching the image:",A),b(A)})}));return Promise.all(w)}return{dataSource:o,setDataSource:v,faqList:n,setFaqList:h,getDetails:Q,timer:u,editQaSet:L,setEditQaSet:t,editModalVisible:a,setEditModalVisible:c,faqTimer:p,getFaqList:x,faqType:f,setFaqType:E,total:d,setTotal:B,pageNum:g,setPageNum:C,loading:i,setLoading:r}},{persist:{storage:sessionStorage}});export{S as _,X as a,m as b,H as f,F as p,k as u};
