import{u as y,g as j,r as Q,f as J,c as q}from"./utils--czjniUZ.js";import{x as D,r as o,R as M,z as S,N as G,A as W,B as X,aO as $}from"./index-Bj9wLH7w.js";import{g as x}from"./index-DtByvqT9.js";var ee=(s=>(s[s.success=0]="success",s[s.parsed=1]="parsed",s[s.error=2]="error",s[s.filebig=3]="filebig",s[s.loading=4]="loading",s[s.failed=5]="failed",s))(ee||{}),k=(s=>(s[s.initing=0]="initing",s[s.default=1]="default",s[s.normal=2]="normal",s[s.optionlist=3]="optionlist",s))(k||{});const se=x().common,te=D("knowledgeBase",()=>{const s=o(""),f=l=>{s.value=l},n=o(""),h=l=>{n.value=l},r=o([]),U=l=>{r.value=l},A=o(""),B=l=>{A.value=l},i=o([]),p=l=>{i.value=l},v=o(k.initing),b=l=>{v.value=l},L=o(!1);return{currentId:s,newKbId:n,setNewKbId:h,setCurrentId:f,knowledgeBaseList:i,setKnowledgeBaseList:p,showDeleteModal:L,setShowDeleteModal:l=>{L.value=l},showDefault:v,setDefault:b,getList:async()=>{var l,u;try{const d=await y.kbList();if(+d.code==200)if(((l=d==null?void 0:d.data)==null?void 0:l.length)>0){const I=d.data.filter(N=>!/.*_FAQ$/.test(N.kb_name));p(I),b(k.normal),r.value.length||r.value.push((u=I[0])==null?void 0:u.kb_id)}else b(k.default)}catch(d){M.error(d.msg||se.error)}},currentKbName:A,setCurrentKbName:B,selectList:r,setSelectList:U}}),P=x().home,ae=x().common,ue=D("knowledgeModal",()=>{const s=o(!1),f=c=>{s.value=c},n=o(!1),h=c=>{n.value=c},r=o(P.upload),U=c=>{r.value=c},A=o(""),B=c=>{A.value=c},i=o([]),p=c=>{i.value=c},v=o([]);return{modalVisible:s,setModalVisible:f,urlModalVisible:n,setUrlModalVisible:h,knowledgeName:A,setKnowledgeName:B,fileList:i,setFileList:p,urlList:v,setUrlList:c=>{v.value=c},modalTitle:r,setModalTitle:U,$reset:()=>{s.value=!1,r.value=P.upload,A.value="",i.value=[],v.value=[]},getFileList:async c=>{try{const l=await y.fileList({kb_id:c});l.code==200&&(l.data.details.forEach(u=>{u.errorText=j(u)}),p(l.data.details))}catch(l){console.log(l),M.error(l.msg||ae.error)}}}}),{currentId:T}=S(te()),de=D("option-list",()=>{const s=o([]),f=e=>{s.value=e},n=o({green:0,gray:0,yellow:0,red:0}),h=o(0),r=e=>{h.value=e},U=o(1),A=e=>{U.value=e},B=o(10),i=o([]),p=e=>{i.value=e},v=o(0),b=e=>{v.value=e},L=o(1),O=e=>{L.value=e},c=o(10),l=o(!1),u=e=>{l.value=e},d=o("upload"),I=e=>{d.value=e},N=o(null),R=e=>{N.value=e},z=o(!1),Y=e=>{z.value=e},m=o(null),K=async()=>{m.value&&clearTimeout(m.value);const e=await Q(await y.fileList({kb_id:T.value,page_offset:U.value,page_limit:B.value}));Object.keys(n.value).forEach(a=>{n.value[a]=0}),Object.assign(n.value,e.status_count),f([]),r(e.total);const C=(a="",g="green")=>g!=="green"?a:JSON.parse(a.toString());e==null||e.details.forEach((a,g)=>{s.value.push({id:1e4+g,fileId:a==null?void 0:a.file_id,fileIdName:a==null?void 0:a.file_name,status:a==null?void 0:a.status,bytes:J((a==null?void 0:a.bytes)||0),createtime:q(a==null?void 0:a.timestamp),remark:(a==null?void 0:a.status)==="gray"?"":C(a==null?void 0:a.msg,a==null?void 0:a.status)})}),(e==null?void 0:e.details.some(a=>a.status==="gray"||a.status==="yellow"))?(console.log("有解析中的  5后再次请求"),m.value=setTimeout(()=>{clearTimeout(m.value),K()},5e3)):(console.log("当页全部解析完成"),_())},_=()=>{let e=null;e=setInterval(async()=>{const C=await Q(await y.fileList({kb_id:T.value,page_offset:1,page_limit:B.value}));Object.keys(n.value).forEach(t=>{n.value[t]=0}),Object.assign(n.value,C.status_count),r(C.total),n.value.gray===0&&n.value.yellow===0&&clearInterval(e)},5e3)},F=o(null),V=async()=>{console.log("getgfqaqw");try{F.value&&clearTimeout(F.value),u(!0);const e=await Q(await y.fileList({kb_id:T.value+"_FAQ",page_offset:L.value,page_limit:c.value}));if(p([]),e!=null&&e.details)b(e.total);else{b(0),u(!1);return}for(const t of e==null?void 0:e.details){const a=e==null?void 0:e.details.indexOf(t);i.value.push({id:1e4+a,faqId:t==null?void 0:t.file_id,question:t==null?void 0:t.question,answer:t==null?void 0:t.answer,status:t==null?void 0:t.status,bytes:`${t==null?void 0:t.content_length}字符`,createtime:q(t==null?void 0:t.timestamp),picUrlList:[]}),t!=null&&t.picUrlList&&await Z(t==null?void 0:t.picUrlList).then(g=>{console.log("成功获取图片文件:",g),i.value[a].picUrlList=t==null?void 0:t.picUrlList.map((w,E)=>({uid:-E,name:"image",status:"done",url:w,originFileObj:g[E]}))}).catch(g=>{console.error("获取图片文件出错:",g)})}(e==null?void 0:e.details.some(t=>t.status==="gray"||t.status==="yellow"))?(console.log("有解析中的  5s后再次请求"),F.value=setTimeout(()=>{clearTimeout(F.value),V()},5e3)):console.log("全部解析完成")}catch(e){console.log(e),M.error(e.msg||"获取faq列表失败")}u(!1)};function Z(e){const C=e.map(t=>new Promise((a,g)=>{fetch(t).then(w=>w.blob()).then(w=>{const E=t.substring(t.lastIndexOf("/")+1),H=new File([w],E,{type:w.type});a(H)}).catch(w=>{console.error("Error fetching the image:",w),g(w)})}));return Promise.all(C)}return{dataSource:s,setDataSource:f,faqList:i,setFaqList:p,getDetails:K,timer:m,editQaSet:N,setEditQaSet:R,editModalVisible:z,setEditModalVisible:Y,faqTimer:F,getFaqList:V,faqType:d,setFaqType:I,total:v,pageSize:c,setTotal:b,pageNum:L,setPageNum:O,loading:l,setLoading:u,totalStatus:n,kbTotal:h,kbPageSize:B,kbPageNum:U,setKbPageNum:A}},{persist:{storage:sessionStorage}}),oe={},le={class:""};function ne(s,f){return W(),X("div",le,[$(s.$slots,"default",{},void 0,!0)])}const ge=G(oe,[["render",ne],["__scopeId","data-v-629ddaa7"]]),fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",ve=D("useUploadFiles",()=>{const s=o([]),f=()=>{s.value=[]},n=o([]);return{uploadFileList:s,initUploadFileList:f,uploadFileListQuick:n,initUploadFileListQuick:()=>{n.value=[]}}});export{ge as U,fe as _,ue as a,de as b,ve as c,ee as f,k as p,te as u};
