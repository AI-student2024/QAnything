import{u as E,g as H,r as K,f as J,c as z}from"./utils-NKScgdcV.js";import{x as D,r as a,R as T,z as j,N as _,A as G,B as S,aO as W}from"./index-DN1u8CS-.js";import{g as k}from"./index-C1my0NQg.js";var X=(s=>(s[s.success=0]="success",s[s.parsed=1]="parsed",s[s.error=2]="error",s[s.filebig=3]="filebig",s[s.loading=4]="loading",s[s.failed=5]="failed",s))(X||{}),y=(s=>(s[s.initing=0]="initing",s[s.default=1]="default",s[s.normal=2]="normal",s[s.optionlist=3]="optionlist",s))(y||{});const $=k().common,ee=D("knowledgeBase",()=>{const s=a(""),g=l=>{s.value=l},c=a(""),p=l=>{c.value=l},u=a([]),b=l=>{u.value=l},w=a(""),U=l=>{w.value=l},i=a([]),v=l=>{i.value=l},f=a(y.initing),h=l=>{f.value=l},B=a(!1);return{currentId:s,newKbId:c,setNewKbId:p,setCurrentId:g,knowledgeBaseList:i,setKnowledgeBaseList:v,showDeleteModal:B,setShowDeleteModal:l=>{B.value=l},showDefault:f,setDefault:h,getList:async()=>{var l;try{const r=await E.kbList();if(+r.code==200)if(((l=r==null?void 0:r.data)==null?void 0:l.length)>0){const F=r.data.filter(m=>!/.*_FAQ$/.test(m.kb_name));v(F),h(y.normal),u.value.length||u.value.push(F[0].kb_id)}else h(y.default)}catch(r){T.error(r.msg||$.error)}},currentKbName:w,setCurrentKbName:U,selectList:u,setSelectList:b}}),V=k().home,se=k().common,re=D("knowledgeModal",()=>{const s=a(!1),g=n=>{s.value=n},c=a(!1),p=n=>{c.value=n},u=a(V.upload),b=n=>{u.value=n},w=a(""),U=n=>{w.value=n},i=a([]),v=n=>{i.value=n},f=a([]);return{modalVisible:s,setModalVisible:g,urlModalVisible:c,setUrlModalVisible:p,knowledgeName:w,setKnowledgeName:U,fileList:i,setFileList:v,urlList:f,setUrlList:n=>{f.value=n},modalTitle:u,setModalTitle:b,$reset:()=>{s.value=!1,u.value=V.upload,w.value="",i.value=[],f.value=[]},getFileList:async n=>{try{const l=await E.fileList({kb_id:n});l.code==200&&(l.data.details.forEach(r=>{r.errorText=H(r)}),v(l.data.details))}catch(l){console.log(l),T.error(l.msg||se.error)}}}}),{currentId:R}=j(ee()),ie=D("option-list",()=>{const s=a([]),g=e=>{s.value=e},c=a({green:0,gray:0,yellow:0,red:0}),p=a(0),u=e=>{p.value=e},b=a(1),w=e=>{b.value=e},U=a(10),i=a([]),v=e=>{i.value=e},f=a(0),h=e=>{f.value=e},B=a(1),Q=e=>{B.value=e},n=a(!1),l=e=>{n.value=e},r=a("upload"),F=e=>{r.value=e},m=a(null),Y=e=>{m.value=e},M=a(!1),P=e=>{M.value=e},L=a(null),O=async()=>{L.value&&clearTimeout(L.value);const e=await K(await E.fileList({kb_id:R.value,page_offset:b.value,page_limit:U.value}));Object.keys(c.value).forEach(t=>{c.value[t]=0}),Object.assign(c.value,e.status_count),g([]),u(e.total);const I=(t="",d="green")=>d!=="green"?t:JSON.parse(t.toString());e==null||e.details.forEach((t,d)=>{s.value.push({id:1e4+d,fileId:t==null?void 0:t.file_id,fileIdName:t==null?void 0:t.file_name,status:t==null?void 0:t.status,bytes:J((t==null?void 0:t.bytes)||0),createtime:z(t==null?void 0:t.timestamp),remark:(t==null?void 0:t.status)==="gray"?"":I(t==null?void 0:t.msg,t==null?void 0:t.status)})}),(e==null?void 0:e.details.some(t=>t.status==="gray"||t.status==="yellow"))?(console.log("有解析中的  5后再次请求"),L.value=setTimeout(()=>{clearTimeout(L.value),O()},5e3)):console.log("全部解析完成")},C=a(null),x=async()=>{try{C.value&&clearTimeout(C.value),l(!0);const e=await K(await E.fileList({kb_id:R.value+"_FAQ"}));if(v([]),!(e!=null&&e.details)){h(0),l(!1);return}for(const o of e==null?void 0:e.details){const t=e==null?void 0:e.details.indexOf(o);i.value.push({id:1e4+t,faqId:o==null?void 0:o.file_id,question:o==null?void 0:o.question,answer:o==null?void 0:o.answer,status:o==null?void 0:o.status,bytes:`${o==null?void 0:o.content_length}字符`,createtime:z(o==null?void 0:o.timestamp),picUrlList:[]}),o!=null&&o.picUrlList&&await Z(o==null?void 0:o.picUrlList).then(d=>{console.log("成功获取图片文件:",d),i.value[t].picUrlList=o==null?void 0:o.picUrlList.map((A,N)=>({uid:-N,name:"image",status:"done",url:A,originFileObj:d[N]}))}).catch(d=>{console.error("获取图片文件出错:",d)})}(e==null?void 0:e.details.some(o=>o.status==="gray"||o.status==="yellow"))?(console.log("有解析中的  5s后再次请求"),C.value=setTimeout(()=>{clearTimeout(C.value),x()},5e3)):console.log("全部解析完成")}catch(e){console.log(e),T.error(e.msg||"获取faq列表失败")}l(!1)};function Z(e){const I=e.map(o=>new Promise((t,d)=>{fetch(o).then(A=>A.blob()).then(A=>{const N=o.substring(o.lastIndexOf("/")+1),q=new File([A],N,{type:A.type});t(q)}).catch(A=>{console.error("Error fetching the image:",A),d(A)})}));return Promise.all(I)}return{dataSource:s,setDataSource:g,faqList:i,setFaqList:v,getDetails:O,timer:L,editQaSet:m,setEditQaSet:Y,editModalVisible:M,setEditModalVisible:P,faqTimer:C,getFaqList:x,faqType:r,setFaqType:F,total:f,setTotal:h,pageNum:B,setPageNum:Q,loading:n,setLoading:l,totalStatus:c,kbTotal:p,kbPageSize:U,kbPageNum:b,setKbPageNum:w}},{persist:{storage:sessionStorage}}),te={},oe={class:""};function ae(s,g){return G(),S("div",oe,[W(s.$slots,"default",{},void 0,!0)])}const ue=_(te,[["render",ae],["__scopeId","data-v-629ddaa7"]]),de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",ge=D("useUploadFiles",()=>{const s=a([]),g=()=>{s.value=[]},c=a([]);return{uploadFileList:s,initUploadFileList:g,uploadFileListQuick:c,initUploadFileListQuick:()=>{c.value=[]}}});export{ue as U,de as _,re as a,ie as b,ge as c,X as f,y as p,ee as u};
