import{b as St}from"./html2canvas.esm-D1ke8z11.js";import{u as Te}from"./useChatSetting-DXI5K0PP.js";import{a as wt,L as xt}from"./ChatInfoPanel-CVj06cqM.js";import{r as F,a8 as At,j as ge,a9 as $t,aa as It,ab as Ne,k as Ot,ac as st,ad as De,d as ee,a as $,_ as oe,c as i,f as Z,F as le,ae as Pt,g as Dt,m as Ft,h as Lt,af as Tt,u as Nt,ag as Rt,ah as Et,ai as Mt,n as zt,I as ot,a6 as nt,w as he,x as K,y as k,z as W,A as O,B as m,D as a,T as H,C as S,E as Re,U as Ee,G as V,H as fe,o as jt,$ as Wt,J as U,R as X,Z as Ut,a3 as Fe,aj as Bt,b as at,S as lt,ak as Pe,K as Qe,L as Ht,X as Vt,Y as qt}from"./index-CVjowkL6.js";import{g as ce}from"./index-Ck4zvxVH.js";import{d as Qt,B as ke}from"./RightOutlined-B8T6erWu.js";import{M as Se,u as Zt,_ as Xt}from"./useChatSource-Bckutulg.js";import{r as re,u as ie,a as Gt,b as Kt}from"./utils-Ugh35qEN.js";import{_ as Yt,b as _e,a as Le,u as Ce,c as Ze,p as rt}from"./useUploadFiles-DgMSXBZV.js";import{i as Me}from"./initDefaultProps-U-O0SP5N.js";import{C as Jt}from"./index-xWCwNqZY.js";import{_ as ze}from"./index-wYqO6F8P.js";import{S as es}from"./index-BHZunxl1.js";import{_ as it,a as ts}from"./index-CWYK6D2A.js";import{_ as ss}from"./ActionButton-CtWgvvKY.js";const os=()=>{const e=F(new Map),t=o=>s=>{e.value.set(o,s)};return At(()=>{e.value=new Map}),[t,e]},ns=["normal","exception","active","success"],we=()=>({prefixCls:String,type:ge(),percent:Number,format:$t(),status:ge(),showInfo:It(),strokeWidth:Number,strokeLinecap:ge(),strokeColor:Ne(),trailColor:String,width:Number,success:Ot(),gapDegree:Number,gapPosition:ge(),size:st([String,Number,Array]),steps:Number,successPercent:Number,title:String,progressStatus:ge()});function ue(e){return!e||e<0?0:e>100?100:e}function be(e){let{success:t,successPercent:o}=e,s=o;return t&&"progress"in t&&(Qt(!1,"Progress","`success.progress` is deprecated. Please use `success.percent` instead."),s=t.progress),t&&"percent"in t&&(s=t.percent),s}function as(e){let{percent:t,success:o,successPercent:s}=e;const n=ue(be({success:o,successPercent:s}));return[n,ue(ue(t)-n)]}function ls(e){let{success:t={},strokeColor:o}=e;const{strokeColor:s}=t;return[s||De.green,o||null]}const xe=(e,t,o)=>{var s,n,v,l;let r=-1,c=-1;if(t==="step"){const C=o.steps,u=o.strokeWidth;typeof e=="string"||typeof e>"u"?(r=e==="small"?2:14,c=u??8):typeof e=="number"?[r,c]=[e,e]:[r=14,c=8]=e,r*=C}else if(t==="line"){const C=o==null?void 0:o.strokeWidth;typeof e=="string"||typeof e>"u"?c=C||(e==="small"?6:8):typeof e=="number"?[r,c]=[e,e]:[r=-1,c=8]=e}else(t==="circle"||t==="dashboard")&&(typeof e=="string"||typeof e>"u"?[r,c]=e==="small"?[60,60]:[120,120]:typeof e=="number"?[r,c]=[e,e]:(r=(n=(s=e[0])!==null&&s!==void 0?s:e[1])!==null&&n!==void 0?n:120,c=(l=(v=e[0])!==null&&v!==void 0?v:e[1])!==null&&l!==void 0?l:120));return{width:r,height:c}};var rs=function(e,t){var o={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(o[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(o[s[n]]=e[s[n]]);return o};const is=()=>oe(oe({},we()),{strokeColor:Ne(),direction:ge()}),cs=e=>{let t=[];return Object.keys(e).forEach(o=>{const s=parseFloat(o.replace(/%/g,""));isNaN(s)||t.push({key:s,value:e[o]})}),t=t.sort((o,s)=>o.key-s.key),t.map(o=>{let{key:s,value:n}=o;return`${n} ${s}%`}).join(", ")},us=(e,t)=>{const{from:o=De.blue,to:s=De.blue,direction:n=t==="rtl"?"to left":"to right"}=e,v=rs(e,["from","to","direction"]);if(Object.keys(v).length!==0){const l=cs(v);return{backgroundImage:`linear-gradient(${n}, ${l})`}}return{backgroundImage:`linear-gradient(${n}, ${o}, ${s})`}},ds=ee({compatConfig:{MODE:3},name:"ProgressLine",inheritAttrs:!1,props:is(),setup(e,t){let{slots:o,attrs:s}=t;const n=$(()=>{const{strokeColor:y,direction:f}=e;return y&&typeof y!="string"?us(y,f):{backgroundColor:y}}),v=$(()=>e.strokeLinecap==="square"||e.strokeLinecap==="butt"?0:void 0),l=$(()=>e.trailColor?{backgroundColor:e.trailColor}:void 0),r=$(()=>{var y;return(y=e.size)!==null&&y!==void 0?y:[-1,e.strokeWidth||(e.size==="small"?6:8)]}),c=$(()=>xe(r.value,"line",{strokeWidth:e.strokeWidth})),C=$(()=>{const{percent:y}=e;return oe({width:`${ue(y)}%`,height:`${c.value.height}px`,borderRadius:v.value},n.value)}),u=$(()=>be(e)),b=$(()=>{const{success:y}=e;return{width:`${ue(u.value)}%`,height:`${c.value.height}px`,borderRadius:v.value,backgroundColor:y==null?void 0:y.strokeColor}}),h={width:c.value.width<0?"100%":c.value.width,height:`${c.value.height}px`};return()=>{var y;return i(le,null,[i("div",Z(Z({},s),{},{class:[`${e.prefixCls}-outer`,s.class],style:[s.style,h]}),[i("div",{class:`${e.prefixCls}-inner`,style:l.value},[i("div",{class:`${e.prefixCls}-bg`,style:C.value},null),u.value!==void 0?i("div",{class:`${e.prefixCls}-success-bg`,style:b.value},null):null])]),(y=o.default)===null||y===void 0?void 0:y.call(o)])}}}),ps={percent:0,prefixCls:"vc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1},gs=e=>{const t=F(null);return Pt(()=>{const o=Date.now();let s=!1;e.value.forEach(n=>{const v=(n==null?void 0:n.$el)||n;if(!v)return;s=!0;const l=v.style;l.transitionDuration=".3s, .3s, .3s, .06s",t.value&&o-t.value<100&&(l.transitionDuration="0s, 0s")}),s&&(t.value=Date.now())}),e},fs={gapDegree:Number,gapPosition:{type:String},percent:{type:[Array,Number]},prefixCls:String,strokeColor:{type:[Object,String,Array]},strokeLinecap:{type:String},strokeWidth:Number,trailColor:String,trailWidth:Number,transition:String};var ms=function(e,t){var o={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(o[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(o[s[n]]=e[s[n]]);return o};let Xe=0;function Ge(e){return+e.replace("%","")}function Ke(e){return Array.isArray(e)?e:[e]}function Ye(e,t,o,s){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,v=arguments.length>5?arguments[5]:void 0;const l=50-s/2;let r=0,c=-l,C=0,u=-2*l;switch(v){case"left":r=-l,c=0,C=2*l,u=0;break;case"right":r=l,c=0,C=-2*l,u=0;break;case"bottom":c=l,u=2*l;break}const b=`M 50,50 m ${r},${c}
   a ${l},${l} 0 1 1 ${C},${-u}
   a ${l},${l} 0 1 1 ${-C},${u}`,h=Math.PI*2*l,y={stroke:o,strokeDasharray:`${t/100*(h-n)}px ${h}px`,strokeDashoffset:`-${n/2+e/100*(h-n)}px`,transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s"};return{pathString:b,pathStyle:y}}const vs=ee({compatConfig:{MODE:3},name:"VCCircle",props:Me(fs,ps),setup(e){Xe+=1;const t=F(Xe),o=$(()=>Ke(e.percent)),s=$(()=>Ke(e.strokeColor)),[n,v]=os();gs(v);const l=()=>{const{prefixCls:r,strokeWidth:c,strokeLinecap:C,gapDegree:u,gapPosition:b}=e;let h=0;return o.value.map((y,f)=>{const p=s.value[f]||s.value[s.value.length-1],T=Object.prototype.toString.call(p)==="[object Object]"?`url(#${r}-gradient-${t.value})`:"",{pathString:D,pathStyle:g}=Ye(h,y,p,c,u,b);h+=y;const A={key:f,d:D,stroke:T,"stroke-linecap":C,"stroke-width":c,opacity:y===0?0:1,"fill-opacity":"0",class:`${r}-circle-path`,style:g};return i("path",Z({ref:n(f)},A),null)})};return()=>{const{prefixCls:r,strokeWidth:c,trailWidth:C,gapDegree:u,gapPosition:b,trailColor:h,strokeLinecap:y,strokeColor:f}=e,p=ms(e,["prefixCls","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","strokeColor"]),{pathString:T,pathStyle:D}=Ye(0,100,h,c,u,b);delete p.percent;const g=s.value.find(P=>Object.prototype.toString.call(P)==="[object Object]"),A={d:T,stroke:h,"stroke-linecap":y,"stroke-width":C||c,"fill-opacity":"0",class:`${r}-circle-trail`,style:D};return i("svg",Z({class:`${r}-circle`,viewBox:"0 0 100 100"},p),[g&&i("defs",null,[i("linearGradient",{id:`${r}-gradient-${t.value}`,x1:"100%",y1:"0%",x2:"0%",y2:"0%"},[Object.keys(g).sort((P,B)=>Ge(P)-Ge(B)).map((P,B)=>i("stop",{key:B,offset:P,"stop-color":g[P]},null))])]),i("path",A,null),l().reverse()])}}}),hs=()=>oe(oe({},we()),{strokeColor:Ne()}),ys=3,_s=e=>ys/e*100,Cs=ee({compatConfig:{MODE:3},name:"ProgressCircle",inheritAttrs:!1,props:Me(hs(),{trailColor:null}),setup(e,t){let{slots:o,attrs:s}=t;const n=$(()=>{var p;return(p=e.width)!==null&&p!==void 0?p:120}),v=$(()=>{var p;return(p=e.size)!==null&&p!==void 0?p:[n.value,n.value]}),l=$(()=>xe(v.value,"circle")),r=$(()=>{if(e.gapDegree||e.gapDegree===0)return e.gapDegree;if(e.type==="dashboard")return 75}),c=$(()=>({width:`${l.value.width}px`,height:`${l.value.height}px`,fontSize:`${l.value.width*.15+6}px`})),C=$(()=>{var p;return(p=e.strokeWidth)!==null&&p!==void 0?p:Math.max(_s(l.value.width),6)}),u=$(()=>e.gapPosition||e.type==="dashboard"&&"bottom"||void 0),b=$(()=>as(e)),h=$(()=>Object.prototype.toString.call(e.strokeColor)==="[object Object]"),y=$(()=>ls({success:e.success,strokeColor:e.strokeColor})),f=$(()=>({[`${e.prefixCls}-inner`]:!0,[`${e.prefixCls}-circle-gradient`]:h.value}));return()=>{var p;const T=i(vs,{percent:b.value,strokeWidth:C.value,trailWidth:C.value,strokeColor:y.value,strokeLinecap:e.strokeLinecap,trailColor:e.trailColor,prefixCls:e.prefixCls,gapDegree:r.value,gapPosition:u.value},null);return i("div",Z(Z({},s),{},{class:[f.value,s.class],style:[s.style,c.value]}),[l.value.width<=20?i(ze,null,{default:()=>[i("span",null,[T])],title:o.default}):i(le,null,[T,(p=o.default)===null||p===void 0?void 0:p.call(o)])])}}}),bs=()=>oe(oe({},we()),{steps:Number,strokeColor:st(),trailColor:String}),ks=ee({compatConfig:{MODE:3},name:"Steps",props:bs(),setup(e,t){let{slots:o}=t;const s=$(()=>Math.round(e.steps*((e.percent||0)/100))),n=$(()=>{var r;return(r=e.size)!==null&&r!==void 0?r:[e.size==="small"?2:14,e.strokeWidth||8]}),v=$(()=>xe(n.value,"step",{steps:e.steps,strokeWidth:e.strokeWidth||8})),l=$(()=>{const{steps:r,strokeColor:c,trailColor:C,prefixCls:u}=e,b=[];for(let h=0;h<r;h+=1){const y=Array.isArray(c)?c[h]:c,f={[`${u}-steps-item`]:!0,[`${u}-steps-item-active`]:h<=s.value-1};b.push(i("div",{key:h,class:f,style:{backgroundColor:h<=s.value-1?y:C,width:`${v.value.width/r}px`,height:`${v.value.height}px`}},null))}return b});return()=>{var r;return i("div",{class:`${e.prefixCls}-steps-outer`},[l.value,(r=o.default)===null||r===void 0?void 0:r.call(o)])}}}),Ss=new Tt("antProgressActive",{"0%":{transform:"translateX(-100%) scaleX(0)",opacity:.1},"20%":{transform:"translateX(-100%) scaleX(0)",opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}}),ws=e=>{const{componentCls:t,iconCls:o}=e;return{[t]:oe(oe({},Lt(e)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:e.fontSize,marginInlineEnd:e.marginXS,marginBottom:e.marginXS},[`${t}-outer`]:{display:"inline-block",width:"100%"},[`&${t}-show-info`]:{[`${t}-outer`]:{marginInlineEnd:`calc(-2em - ${e.marginXS}px)`,paddingInlineEnd:`calc(2em + ${e.paddingXS}px)`}},[`${t}-inner`]:{position:"relative",display:"inline-block",width:"100%",overflow:"hidden",verticalAlign:"middle",backgroundColor:e.progressRemainingColor,borderRadius:e.progressLineRadius},[`${t}-inner:not(${t}-circle-gradient)`]:{[`${t}-circle-path`]:{stroke:e.colorInfo}},[`${t}-success-bg, ${t}-bg`]:{position:"relative",backgroundColor:e.colorInfo,borderRadius:e.progressLineRadius,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`},[`${t}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:e.colorSuccess},[`${t}-text`]:{display:"inline-block",width:"2em",marginInlineStart:e.marginXS,color:e.progressInfoTextColor,lineHeight:1,whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[o]:{fontSize:e.fontSize}},[`&${t}-status-active`]:{[`${t}-bg::before`]:{position:"absolute",inset:0,backgroundColor:e.colorBgContainer,borderRadius:e.progressLineRadius,opacity:0,animationName:Ss,animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${t}-status-exception`]:{[`${t}-bg`]:{backgroundColor:e.colorError},[`${t}-text`]:{color:e.colorError}},[`&${t}-status-exception ${t}-inner:not(${t}-circle-gradient)`]:{[`${t}-circle-path`]:{stroke:e.colorError}},[`&${t}-status-success`]:{[`${t}-bg`]:{backgroundColor:e.colorSuccess},[`${t}-text`]:{color:e.colorSuccess}},[`&${t}-status-success ${t}-inner:not(${t}-circle-gradient)`]:{[`${t}-circle-path`]:{stroke:e.colorSuccess}}})}},xs=e=>{const{componentCls:t,iconCls:o}=e;return{[t]:{[`${t}-circle-trail`]:{stroke:e.progressRemainingColor},[`&${t}-circle ${t}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${t}-circle ${t}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:e.colorText,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[o]:{fontSize:`${e.fontSize/e.fontSizeSM}em`}},[`${t}-circle&-status-exception`]:{[`${t}-text`]:{color:e.colorError}},[`${t}-circle&-status-success`]:{[`${t}-text`]:{color:e.colorSuccess}}},[`${t}-inline-circle`]:{lineHeight:1,[`${t}-inner`]:{verticalAlign:"bottom"}}}},As=e=>{const{componentCls:t}=e;return{[t]:{[`${t}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,marginInlineEnd:e.progressStepMarginInlineEnd,backgroundColor:e.progressRemainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.colorInfo}}}}}},$s=e=>{const{componentCls:t,iconCls:o}=e;return{[t]:{[`${t}-small&-line, ${t}-small&-line ${t}-text ${o}`]:{fontSize:e.fontSizeSM}}}},Is=Dt("Progress",e=>{const t=e.marginXXS/2,o=Ft(e,{progressLineRadius:100,progressInfoTextColor:e.colorText,progressDefaultColor:e.colorInfo,progressRemainingColor:e.colorFillSecondary,progressStepMarginInlineEnd:t,progressStepMinWidth:t,progressActiveMotionDuration:"2.4s"});return[ws(o),xs(o),As(o),$s(o)]});var Os=function(e,t){var o={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(o[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(o[s[n]]=e[s[n]]);return o};const Ps=ee({compatConfig:{MODE:3},name:"AProgress",inheritAttrs:!1,props:Me(we(),{type:"line",percent:0,showInfo:!0,trailColor:null,size:"default",strokeLinecap:"round"}),slots:Object,setup(e,t){let{slots:o,attrs:s}=t;const{prefixCls:n,direction:v}=Nt("progress",e),[l,r]=Is(n),c=$(()=>Array.isArray(e.strokeColor)?e.strokeColor[0]:e.strokeColor),C=$(()=>{const{percent:f=0}=e,p=be(e);return parseInt(p!==void 0?p.toString():f.toString(),10)}),u=$(()=>{const{status:f}=e;return!ns.includes(f)&&C.value>=100?"success":f||"normal"}),b=$(()=>{const{type:f,showInfo:p,size:T}=e,D=n.value;return{[D]:!0,[`${D}-inline-circle`]:f==="circle"&&xe(T,"circle").width<=20,[`${D}-${f==="dashboard"&&"circle"||f}`]:!0,[`${D}-status-${u.value}`]:!0,[`${D}-show-info`]:p,[`${D}-${T}`]:T,[`${D}-rtl`]:v.value==="rtl",[r.value]:!0}}),h=$(()=>typeof e.strokeColor=="string"||Array.isArray(e.strokeColor)?e.strokeColor:void 0),y=()=>{const{showInfo:f,format:p,type:T,percent:D,title:g}=e,A=be(e);if(!f)return null;let P;const B=p||(o==null?void 0:o.format)||(ne=>`${ne}%`),R=T==="line";return p||o!=null&&o.format||u.value!=="exception"&&u.value!=="success"?P=B(ue(D),ue(A)):u.value==="exception"?P=R?i(Rt,null,null):i(Et,null,null):u.value==="success"&&(P=R?i(Mt,null,null):i(Jt,null,null)),i("span",{class:`${n.value}-text`,title:g===void 0&&typeof P=="string"?P:void 0},[P])};return()=>{const{type:f,steps:p,title:T}=e,{class:D}=s,g=Os(s,["class"]),A=y();let P;return f==="line"?P=p?i(ks,Z(Z({},e),{},{strokeColor:h.value,prefixCls:n.value,steps:p}),{default:()=>[A]}):i(ds,Z(Z({},e),{},{strokeColor:c.value,prefixCls:n.value,direction:v.value}),{default:()=>[A]}):(f==="circle"||f==="dashboard")&&(P=i(Cs,Z(Z({},e),{},{prefixCls:n.value,strokeColor:c.value,progressStatus:u.value}),{default:()=>[A]})),l(i("div",Z(Z({role:"progressbar"},g),{},{class:[b.value,D],title:T}),[P]))}}}),Ds=zt(Ps);var Fs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};function Je(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?Object(arguments[t]):{},s=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(o).filter(function(n){return Object.getOwnPropertyDescriptor(o,n).enumerable}))),s.forEach(function(n){Ls(e,n,o[n])})}return e}function Ls(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var je=function(t,o){var s=Je({},t,o.attrs);return i(ot,Je({},s,{icon:Fs}),null)};je.displayName="MinusCircleOutlined";je.inheritAttrs=!1;var Ts={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"};function et(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?Object(arguments[t]):{},s=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(o).filter(function(n){return Object.getOwnPropertyDescriptor(o,n).enumerable}))),s.forEach(function(n){Ns(e,n,o[n])})}return e}function Ns(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var We=function(t,o){var s=et({},t,o.attrs);return i(ot,et({},s,{icon:Ts}),null)};We.displayName="PlusCircleOutlined";We.inheritAttrs=!1;const fn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAIhSURBVFiF7dkxj6JAFMDx98ZLtMHYGRIKr7Tbzo7O0mQTSr6D+xE29wl273tQbE9hbbed5ZlAhqFDDIkm8N41q3cr6+0OcGI2+y/NjPMLGcEMCCdFUTQionsAuEHEkRBicDqmyYgoYeYEEZ8Q8adpmuuzg6WUD0opzrKMi6LgS5XnOWdZxkopllI+nMMtkiS5GOpcaZqylHJRunJpmrZtO5YkyfFKYhRFI0T8NRwOm9tYDRTHMTDzd8HMd4ZhtO0pZRgGENG9YObbbrfbtqdUr9cDALgRiDjodDpte0oJIeDlNvd/73N1EkIMRNuI9/oC1u3zAcMwhDRNtReqOk8buFqtYDabQRiGH54ThiG4rgvL5VJ3OQCllPaz0vM8tm2bgyB4d2wQBGzbNnuep72OUoorAZk/hqyDqw1k/jeyLq4RIPPbyCZwjQGZXyObwh2A3/R/VuUcxwEAANd1AQBgPp8fP6tbI0CAP8h+vw/T6bSprwVUSvG1/Zs+FMfxJ3zUXTrtPej7Pvi+X2kxx3FgMplozdEGjsfjSg/9w1zdtIGWZYFlWdoLVe3q9+AXsG7XDySipG3EuYgoEcy8JqK2LaWKogBmTgQAPO92u7Y9pfb7PSDi0/Ufv5mmuSaix81m07bp2Ha7BSJ6fHVeLaVcXMMp68vp6uJN+d+H6HmeXwxVFMXZQ3Q8RUZRNGLmO2a+RcTBhV5DrAHgWQjx4/Q1xG82m1G/NnWY4wAAAABJRU5ErkJggg==",Rs=nt("useHomeChat",()=>{const e=F([]),t=g=>{e.value=g};let o=F(e.value.length);he(()=>e.value.length,()=>{o.value=e.value.length});const s=F([]),n=g=>{s.value=g},v=g=>{var R;const A=(((R=s.value.at(-1))==null?void 0:R.historyId)||0)+1,P={historyId:A,title:g},B=[...s.value,P];return n(B),A},l=g=>{const A=s.value.filter(P=>P.historyId!==g);n(A)},r=(g,A,P)=>{const B=s.value.map(R=>(R.historyId===A&&(R.title=g,R.kbIds=P),R));n(B)},c=F([]),C=(g,A)=>{const P={historyId:g,list:A};c.value.some(R=>R.historyId===g)?c.value.forEach(R=>{R.historyId===g&&(R.list=A)}):c.value.push(P)},u=g=>c.value.filter(A=>A.historyId===g)[0],b=g=>{c.value=c.value.filter(A=>A.historyId!==g),s.value=s.value.filter(A=>A.historyId!==g)},h=F(null),y=g=>{h.value=g},f=F(1),p=g=>{f.value=g},T=F(1);return{QA_List:e,setQaList:t,contextLength:o,historyList:s,addHistoryList:v,deleteHistoryList:l,updateHistoryList:r,chatList:c,addChatList:C,getChatById:u,clearChatList:b,chatId:h,setChatId:y,pageId:f,setPageId:p,qaPageId:T,setQaPageId:g=>{T.value=g}}},{persist:{storage:localStorage}}),Es={class:"model-set-dialog-comp"},Ms={class:"select-model"},zs={class:"footer"},js=ee({__name:"ChatSettingDialog",setup(e,{expose:t}){const{contextLength:o}=K(Rs()),{showSettingModal:s}=K(St()),{setChatSettingConfigured:n}=Te(),v=F(),{common:l}=ce(),r=()=>{s.value=!1},c=async b=>{const h=await v.value.onCheck();return Object.hasOwn(h,"errorFields")?!1:(b&&b(h),!0)},C=b=>{s.value=!1,n(b),V.success("应用成功")},u=()=>{c(C)};return t({handleOk:c}),(b,h)=>{const y=ke,f=Se;return k(),W(Ee,{to:"body"},[i(f,{open:a(s),"onUpdate:open":h[0]||(h[0]=p=>Re(s)?s.value=p:null),title:a(l).modelSettingTitle,centered:"",width:"700px","wrap-class-name":"model-set-modal",footer:null,"force-render":!0},{default:O(()=>[m("div",Es,[m("div",Ms,[i(wt,{ref_key:"chatSettingFormRef",ref:v,"context-length":a(o)},null,8,["context-length"])]),m("div",zs,[i(y,{onClick:r},{default:O(()=>[H(S(a(l).cancel),1)]),_:1}),i(y,{type:"primary",style:{width:"auto","margin-left":"10px"},onClick:u},{default:O(()=>[H(S(a(l).confirmApplication),1)]),_:1})])])]),_:1},8,["open","title"])])}}}),mn=fe(js,[["__scopeId","data-v-80a93fe5"]]),Ws="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAKFSURBVFiF1ZjNattAEIC/VH0Ag3O3wb0b+gKF0HMCfoAW/AAFP0ALaZ8guffQvoFzzsF5hNwLUu4F+Q2mB+1Yk9XfriTXycAiWdbufDuz2p2ZMxFJeMHy5tQAXfJ2YP8J8AGYufuZe/4E7N31wd3/N8AJ8Am4Apbud5dsgTvgV6yys8g1+AX4ZqD2wKNrajEoLbqksLBKBvyIAhWRJKC9F5FUStmJyEpEpgF9p+7dnemfisgiRHcI4FpEcgN2ETipprF0orkDHwR4bWZ9MwDMbzdm3Ou+gCszyGZEuLrJr2MBF1K6tXWGA9vG6cilWOfBgKnrOKZbu9ydhgKu2zoEtoWzTshXnkj5hVeWUh2gWq9xXQTA6Riha/fCvZ/7k/IB1Xq7EeDSCAs2WtEPFi7d9Tb8cDnIHLh31wz4SNwZrDqv7EN71E2Av+7+PHLwOrgsor/q/+Pu36l+a0E9M2OjjzHgoDzXNULCB9RQ6fEEcCqq+xAhWUAboZwCzupWY9Va8Ikw+cm4cFZ3LWCszLpfGS4WsELfIWq1OaWrh0rFixZQ/R8SwsNz184ZB7LyHdRZcBkxYMa4kKr7YEF/o65slIFi4TL6b9SVg8J3cWWjDBQLZWFjRHVuaXCx/glF9hYrGcMgVefds6deRDGVMpLumxz1CbcaY9C6eFDD8L4hl040JmDVCVVi0FcZ8idSJDDq6mNkdNo0s8ulIZFvSzt1XYgcJ7PbmPEbE/hXnbhrW0np7lT6J1OJFDuD5h55yFihxaOFjF88qk3U/RZbfvsMfPU24Afay2+2hrgHvhORlMUCWtBLvAysQfQI3QK/iay29gVUaSsBaxl4UAl4KODR5cVX+f8BBZDb8KKHVtYAAAAASUVORK5CYII=",Us="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAP5JREFUOE+tlNENgzAMRM1khY28QcsG3qgwWauz4ujiJKBKzRcY5+U421nkT2uZcVR1FZEnfT/xbGav0Z4ONADsIgIo1qM87xnYgFQVp0FFlxgqZjkVRAmbmR3YSDG8Ax5xKHyLSM1l0IeV0C/CGwCwsSothzzMbMOhDsrBEouNrK4xW1VrDoNy0hq/QmDkuIIcCxDI56y0I8UF5C0COIOqmdwn4RUrSRV0nxjUyB4l50YsSt2SAFWJk+SD/UoeuSVc/kufJgfAH2cwqGsyqkxTiOJb01e3I1I2oRV8WG9HZDBLaESf+NLZfBN0Fb66RuK6wMTHGrZI41E289f3L/XxvhPPyll2AAAAAElFTkSuQmCC",ct=nt("useChunkView",()=>({showChunkModel:F(!1)})),Bs=ee({__name:"LoadingImg",setup(e){const t=F(),o=()=>{t.value&&t.value.classList.add("loading")},s=()=>{t.value&&t.value.classList.remove("loading")};return jt(()=>{o()}),Wt(()=>{s()}),(n,v)=>(k(),U("img",{ref_key:"loadingRef",ref:t,class:"img",src:Yt,alt:"loading"},null,512))}}),tt=fe(Bs,[["__scopeId","data-v-e69df7ef"]]),Hs={key:0,class:"container"},Vs={class:"title"},qs={class:"multi-color-progress"},Qs={class:"progress-outer"},Zs={class:"progress"},Xs={class:"percent"},Gs={class:"percent-text"},Ks="#52c41a",Ys="#FFEB3B",Js="#f5222d",eo="#bfbfbf",to=ee({__name:"UploadProgress",setup(e){const{dataSource:t,totalStatus:o,kbTotal:s}=K(_e()),n=ce().progress,v=F({green:0,yellow:0,red:0,gray:0}),l=F({green:0,yellow:0,red:0,gray:0}),r=F({green:0,yellow:0,red:0,gray:0}),c=()=>{v.value=o.value;for(const b in v.value){const h=v.value[b]/s.value*100;l.value[b]=parseFloat(h.toFixed(2))}const u=100-Object.values(l.value).reduce((b,h)=>b+h,0);u>0&&(l.value.gray+=u),r.value.green=l.value.green,r.value.red=l.value.red+r.value.green,r.value.yellow=l.value.yellow+r.value.red,r.value.gray=l.value.gray+r.value.yellow};return he(()=>o,()=>{c()},{immediate:!0,deep:!0}),(C,u)=>{const b=Ds,h=ze;return a(t).length!==0?(k(),U("div",Hs,[m("span",Vs,S(a(n).uploadTotalProgress)+"：",1),i(h,{title:`${a(n).putStorage}: ${a(v).green},
      ${a(n).inLine}: ${a(v).gray},
      ${a(n).parsing}: ${a(v).yellow},
      ${a(n).failure}: ${a(v).red}`},{default:O(()=>[m("div",qs,[m("div",Qs,[m("div",Zs,[i(b,{percent:a(r).green,class:"progress-segment green",status:"active","stroke-color":Ks},null,8,["percent"]),i(b,{percent:a(r).red,class:"progress-segment red",status:"active","stroke-color":Js},null,8,["percent"]),i(b,{percent:a(r).yellow,class:"progress-segment yellow",status:"active","stroke-color":Ys},null,8,["percent"]),i(b,{percent:a(r).gray,class:"progress-segment gray",status:"active","stroke-color":eo},null,8,["percent"])])]),m("div",Xs,[m("div",Gs,S((a(l).green+a(l).red).toFixed(2))+"% ",1)])])]),_:1},8,["title"])])):X("",!0)}}}),so=fe(to,[["__scopeId","data-v-742741e5"]]),oo={class:"scale"},no={class:"scale-text"},ao={class:"container"},lo={class:"file-preview"},ro={class:"file-preview-content"},io={class:"chunk-table"},co={key:1},uo=["innerHTML"],po={key:2,class:"editable-row-operations"},go={key:0,class:"operation-div"},fo={class:"footer"},mo=ee({__name:"ChunkViewDialog",props:{kbId:{},fileId:{},fileName:{}},setup(e){const{showChunkModel:t}=K(ct()),{common:o}=ce(),{chatSettingFormActive:s}=K(Te()),{setSourceType:n,setSourceUrl:v,setTextContent:l}=Zt(),r=e,{kbId:c,fileId:C,fileName:u}=Ut(r),b=F([{title:"编号",key:"id",dataIndex:"id",width:70},{title:"markdown预览",key:"content",dataIndex:"content",resizable:!0,width:300,minWidth:150,maxWidth:500},{title:"分析结果",key:"editContent",dataIndex:"editContent"},{title:"操作",key:"operation",dataIndex:"operation",width:100}]);function h(w,L){L.width=w}const y=F(!1),f=F(!1),p=F({pageNum:1,pageSize:3,total:0,showSizeChanger:!1,showTotal:w=>`共 ${w} 条`}),T=w=>{p.value.pageNum=w.current,_(c.value,C.value)},D=F([]),g=F({}),A=F(1),P=w=>{g.value[w]=JSON.parse(JSON.stringify(D.value.filter(L=>w===L.key)[0]))},B=async w=>{f.value=!0,V.warn("正在更新……");try{await re(await ie.updateDocCompleted({chunk_size:s.value.chunkSize,doc_id:w,update_content:g.value[w].editContent})),V.success("修改成功"),Object.assign(D.value.filter(L=>w===L.key)[0],g[w]),delete g.value[w]}catch(L){V.error(L.msg)}finally{f.value=!1}},R=w=>{delete g.value[w]},ne=()=>{t.value=!1,!f&&(g.value={})},Y=F(1),I=()=>{Y.value+=.1},z=()=>{Y.value<=.15||(Y.value-=.1)},_=async(w,L)=>{y.value=!0;try{const E=await re(await ie.getDocCompleted({kb_id:w,file_id:L,page_id:p.value.pageNum,page_limit:p.value.pageSize}));A.value=p.value.pageSize*p.value.pageNum-2,p.value.total=E.total_count,D.value=[],E.chunks.forEach(J=>{D.value.push({id:A.value++,key:J.chunk_id,content:J.page_content,editContent:J.page_content})})}catch(E){V.error(E.msg||"获取文档解析结果失败")}finally{y.value=!1}};he(()=>t.value,()=>{t.value?(D.value=[],_(c.value,C.value),j({file_id:C.value,file_name:u.value})):t.value||(Y.value=1,D.value=[],A.value=1,p.value.pageNum=1,p.value.total=1,v(""),l(""))});let d=["pdf","docx","xlsx","txt","md","jpg","png","jpeg","csv","eml"];const N=w=>{if(!w)return!1;const L=w.split(".");if(L.length){const E=L.pop();return!!d.includes(E)}else return!1},j=w=>{console.log("handleChatSource",w),N(w.file_name)&&te(w)};async function te(w){try{v(null);const L=await re(await ie.getFile({file_id:w.file_id})),E=w.file_name.split(".").pop(),J=$e(E);if(console.log("b64Type",J),n(E),v(`data:${J};base64,${L.file_base64}`),E==="txt"||E==="md"||E==="csv"||E==="eml"){const de=atob(L.file_base64),me=decodeURIComponent(escape(de));l(me)}}catch(L){V.error(L.msg||"获取文件失败")}}let Ae=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain","text/markdown","image/jpeg","image/png","image/jpeg","text/csv","message/rfc822","application/vnd.openxmlformats-officedocument.presentationml.presentation"];function $e(w){const L=d.indexOf(w);return Ae[L]}const Ie=w=>w.replace(/\n/g,"<br />");return(w,L)=>{const E=ke,J=ss,de=xt,me=it,Oe=Se,ye=Bt;return k(),W(Ee,{to:"body"},[i(ye,{theme:{token:{colorPrimary:"#5a47e5"}}},{default:O(()=>[i(Oe,{open:a(t),"onUpdate:open":L[0]||(L[0]=se=>Re(t)?t.value=se:null),title:"切片分析结果",centered:"",width:"100%","wrap-class-name":"chunk-modal","destroy-on-close":!0,footer:null,onCancel:ne},{default:O(()=>[m("div",oo,[i(E,{shape:"circle",icon:Fe(a(We)),onClick:I},null,8,["icon"]),m("span",no,S((a(Y)*100).toFixed(0))+"%",1),i(E,{shape:"circle",icon:Fe(a(je)),onClick:z},null,8,["icon"])]),m("div",ao,[m("div",lo,[m("div",ro,[i(es,{"zoom-level":a(Y)},null,8,["zoom-level"])])]),m("div",io,[i(me,{columns:a(b),"data-source":a(D),bordered:"",scroll:{y:"calc(100vh - 32px - 40px - 42px - 64px - 56px)"},pagination:a(p),loading:a(y),onChange:T,onResizeColumn:h},{bodyCell:O(({column:se,record:G})=>[se.dataIndex==="content"?(k(),W(Xt,{key:0,content:a(g)[G.key]?a(g)[G.key].editContent:G.content},null,8,["content"])):X("",!0),se.dataIndex==="editContent"?(k(),U("div",co,[a(g)[G.key]?(k(),W(J,{key:0,value:a(g)[G.key][se.dataIndex],"onUpdate:value":pe=>a(g)[G.key][se.dataIndex]=pe,style:{margin:"-5px 0"},"show-count":"","auto-size":""},null,8,["value","onUpdate:value"])):(k(),U("div",{key:1,innerHTML:Ie(G.content)},null,8,uo))])):se.dataIndex==="operation"?(k(),U("div",po,[a(g)[G.key]?(k(),U("div",go,[i(E,{class:"operation-btn",size:"small",loading:a(f),type:"link",onClick:pe=>B(G.key)},{default:O(()=>[H(S(a(f)?"":a(o).save),1)]),_:2},1032,["loading","onClick"]),a(f)?X("",!0):(k(),W(E,{key:0,class:"operation-btn",size:"small",loading:a(f),type:"text",onClick:pe=>R(G.key)},{default:O(()=>[H(S(a(o).cancel),1)]),_:2},1032,["loading","onClick"]))])):(k(),W(de,{key:1,onClick:pe=>P(G.key)},{default:O(()=>[H(S(a(o).edit),1)]),_:2},1032,["onClick"]))])):X("",!0)]),_:1},8,["columns","data-source","scroll","pagination","loading"])])]),m("div",fo,[i(E,{type:"primary",onClick:ne},{default:O(()=>[H(S(a(o).close),1)]),_:1})])]),_:1},8,["open"])]),_:1})])}}}),vo=fe(mo,[["__scopeId","data-v-66624b3c"]]),ho={class:"file"},yo={class:"box"},_o={class:"before-upload-box"},Co=["accept"],bo={class:"before-upload"},ko={class:"upload-text-box"},So={class:"upload-text"},wo={class:"blue"},xo={class:"desc"},Ao=125*1024*1024,$o=ee({__name:"FileUploadDialog",props:{dialogType:{type:Number,require:!0,default:0}},setup(e){const t=ce().common,{setKnowledgeName:o,setModalVisible:s}=Le(),{setDefault:n}=Ce(),{getDetails:v}=_e(),{modalVisible:l,modalTitle:r}=K(Le()),{currentId:c,currentKbName:C}=K(Ce()),{uploadFileList:u,uploadFileListQuick:b}=K(Ze()),{initUploadFileList:h}=Ze(),{chatSettingFormActive:y}=K(Te()),f=e,p=F(),T=$(()=>c.value.length>0&&u.value.length>0&&u.value.every(I=>I.status!="loading"));he(()=>l.value,()=>{o(C.value),f.dialogType===1&&(u.value=b.value),!l.value&&f.dialogType===0&&h()});const D=[".md",".txt",".pdf",".jpg",".png",".jpeg",".docx",".xlsx",".pptx",".eml",".csv"],g={document:30*1024*1024,image:5*1024*1024},A=async(I,z)=>new Promise((_,d)=>{if(console.log(I),I.name&&D.includes("."+I.name.split(".").pop().toLowerCase())){const N=I.type.startsWith("image/")?g.image:g.document,j=I.type.startsWith("image/")?"图片":"文档";if(I.size>N){d(`单个${j}太大，不能超过 ${N/1024/1024} MB`);return}u.value.push({file_name:I.name,file:I,status:"loading",text:t.uploading,file_id:"",order:u.value.length,bytes:0}),_(z)}else d(`${I.name}的文件格式不符`)}),P=I=>{const z=I.target.files;let _=0;Array.from(z).forEach(d=>{if(_+=d.size,_>=Ao){V.error("文件总大小超过125MB");return}}),Array.from(z).forEach(async(d,N)=>{try{await A(d,N)}catch(j){V.error(j)}}),setTimeout(()=>{u.value.length&&B()})},B=async()=>{var _;Y();const I=[];u.value.forEach(d=>{d.status=="loading"&&I.push(d)});const z=new FormData;for(let d=0;d<I.length;d++)z.append("files",(_=I[d])==null?void 0:_.file);z.append("kb_id",c.value),z.append("user_id",Gt),z.append("chunk_size",y.value.chunkSize.toString()),z.append("mode","soft"),R(0),fetch(Kt+"/local_doc_qa/upload_files",{method:"POST",body:z}).then(d=>{if(d.ok)return d.json();throw new Error("上传失败")}).then(d=>{if(d.code===200){if(d.data.length===0){V.warn(d.msg||"出错了"),Pe.close("upload"),f.dialogType===1&&I.forEach(N=>{u.value[N.order].status="error",u.value[N.order].errorText=(d==null?void 0:d.msg)||t.upFailed});return}R(1),f.dialogType===1&&I.forEach((N,j)=>{let te=d.data[j].status;te=="green"||te=="gray"?te="success":te="error",u.value[N.order].status=te,u.value[N.order].file_id=d.data[j].file_id,u.value[N.order].bytes=d.data[j].bytes,u.value[N.order].errorText=t.upSucceeded})}else V.error(d.msg||"出错了"),Pe.close("upload"),I.forEach(N=>{u.value[N.order].status="error",u.value[N.order].errorText=(d==null?void 0:d.msg)||t.upFailed})}).finally(()=>{v()})},R=I=>{Pe[I?"success":"info"]({key:"upload",message:I?"上传完成":"上传中",description:I?"":"最多需要30s",duration:I?2.5:0})},ne=async()=>{s(!1),n(rt.optionlist),await v()},Y=()=>{s(!1)};return at(()=>{p.value&&clearTimeout(p.value)}),(I,z)=>{const _=ke,d=Se;return k(),W(Ee,{to:"body"},[i(d,{open:a(l),"onUpdate:open":z[1]||(z[1]=N=>Re(l)?l.value=N:null),title:a(r),centered:"",width:"480px","wrap-class-name":"upload-file-modal","destroy-on-close":""},{footer:O(()=>[f.dialogType===0?(k(),W(_,{key:"submit",type:"primary",class:"upload-btn",disabled:!a(T),onClick:ne},{default:O(()=>[H(S(a(t).confirm),1)]),_:1},8,["disabled"])):X("",!0),f.dialogType===1?(k(),W(_,{key:"submit",type:"primary",class:"upload-btn",onClick:Y},{default:O(()=>[H(S(a(t).cancel),1)]),_:1})):X("",!0)]),default:O(()=>[m("div",ho,[m("div",yo,[m("div",_o,[m("input",{class:"hide input",type:"file",accept:D.join(","),multiple:"",onChange:P,onClick:z[0]||(z[0]=N=>N.target.value="")},null,40,Co),m("div",bo,[m("div",ko,[i(lt,{name:"upload"}),m("p",null,[m("span",So,[H(S(a(t).dragUrl)+" ",1),m("span",wo,S(a(t).click),1)])])]),m("p",xo,S(a(t).updesc1),1)])])])])]),_:1},8,["open","title"])])}}}),Io=fe($o,[["__scopeId","data-v-244df073"]]),ut=e=>(Vt("data-v-abe4fe65"),e=e(),qt(),e),Oo={class:"list-page"},Po={class:"content"},Do={class:"options"},Fo=ut(()=>m("img",{src:Ws,alt:"back"},null,-1)),Lo={class:"kb-name"},To={class:"name"},No={class:"id"},Ro={class:"nav-info"},Eo={class:"navs"},Mo=["onClick"],zo={key:0,class:"nav-progress"},jo={class:"handle-btn"},Wo={class:"table"},Uo=ut(()=>m("img",{src:Us,style:{width:"18px","margin-left":"5px"},alt:"©"},null,-1)),Bo={style:{color:"#666","user-select":"text"}},Ho={key:1,class:"status-box"},Vo={class:"icon-file-status"},qo={key:0},Qo={key:1},Zo={key:0,class:"status-box"},Xo={class:"icon-file-status"},Go={key:1,class:"options"},Ko=ee({__name:"OptionList",setup(e){const{setDefault:t,setNewKbId:o}=Ce(),{currentKbName:s,currentId:n}=K(Ce()),{setModalVisible:v,setUrlModalVisible:l,setModalTitle:r}=Le(),{showChunkModel:c}=K(ct()),{getDetails:C,setEditQaSet:u,setEditModalVisible:b,getFaqList:h,setFaqType:y,setPageNum:f,setKbPageNum:p}=_e(),{dataSource:T,faqList:D,timer:g,faqTimer:A,total:P,pageNum:B,pageSize:R,loading:ne,kbTotal:Y,kbPageNum:I,kbPageSize:z}=K(_e()),_=ce().home,d=ce().common,N=ce().bots,j=F(0),te=[{name:_.docSet,value:0},{name:_.qaSet,value:1}],Ae=[{title:_.documentId,dataIndex:"fileId",key:"fileId",width:"11%"},{title:_.documentName,dataIndex:"fileIdName",key:"fileIdName",width:"20%",ellipsis:!0},{title:_.documentStatus,dataIndex:"status",key:"status",width:"15%",ellipsis:!0},{title:_.fileSize,dataIndex:"bytes",key:"bytes",width:"10%"},{title:_.creationDate,dataIndex:"createtime",key:"createtime",width:"11%"},{title:_.remark,dataIndex:"remark",key:"remark",width:"15%"},{title:_.operate,key:"options",width:"10%"}],$e=[{title:"ID",dataIndex:"id",key:"id",width:"8%"},{title:_.question,dataIndex:"question",key:"question",width:"43%",ellipsis:!0},{title:_.status,dataIndex:"status",key:"status",width:"10%",ellipsis:!0},{title:_.characterCount,dataIndex:"bytes",key:"bytes",width:"10%"},{title:_.creationDate,dataIndex:"createtime",key:"createtime",width:"11%"},{title:_.operate,key:"options",width:"10%"}],Ie=$(()=>({current:I.value,pageSize:z.value,total:Y.value,showSizeChanger:!1,showTotal:x=>`共 ${x} 条`})),w=$(()=>({current:B.value,pageSize:R.value,total:P.value,showSizeChanger:!1,showTotal:x=>`共 ${x} 条`}));let L={};const E=x=>{L=x},J=F(""),de=F(""),me=async x=>{console.log("item",x),J.value=x.fileId,de.value=x.fileIdName,c.value=!0},Oe=async()=>{try{await re(await ie.deleteFile({file_ids:[L.fileId],kb_id:n.value})),V.success("删除成功"),await C(),I.value!==1&&T.value.length===0&&(I.value-=1,await C())}catch(x){V.error(x.msg||"删除失败")}};let ye={};const se=x=>{ye=x},G=async()=>{try{await re(await ie.deleteFile({kb_id:`${n.value}_FAQ`,file_ids:[ye.faqId]})),V.success("删除成功"),await h(),B.value!==1&&D.value.length===0&&(B.value-=1,await h())}catch(x){V.error(x.msg||"删除失败")}},pe=x=>{y("edit"),u(x),b(!0)},dt=()=>{t(rt.normal)},pt=()=>{v(!0),r(_.upload)},gt=()=>{l(!0),r(d.addUrl)},ft=()=>{y("upload"),b(!0)},mt=()=>{Se.confirm({title:_.clearAllFile,content:Fe("p",_.clearAllFileConfirm),centered:!0,maskClosable:!0,okText:d.confirm,okType:"danger",async onOk(){try{await re(await ie.clearUpload({status:"gray",kb_ids:[]})),V.success("操作成功"),C()}catch(x){V.error(x.msg||"操作失败")}}})},vt=x=>{let q;switch(x){case"gray":q=d.inLine;break;case"yellow":q=d.parsing;break;case"green":q=d.succeeded;break;default:q=d.failed;break}return q},ht=x=>{let q=d.failed;switch(x){case"gray":q=d.uploadCompleted;break;case"yellow":q=d.inLine;break;case"green":q=d.learningCompleted;break}return q},yt=async()=>{try{if((await re(await ie.kbList())).find(q=>q.kb_id===`${n.value}_FAQ`))return!0}catch(x){return V.error(x.msg||d.error),!0}return!1},_t=async()=>{if(!await yt()){try{await re(await ie.createKb({kb_name:`${s.value}_FAQ`,kb_id:`${n.value}_FAQ`}))}catch(q){return V.error(q.msg||d.error),!1}return!0}},Ct=x=>{j.value=x,x===0?(p(1),clearTimeout(A.value),C()):(f(1),clearTimeout(g.value),h(),_t())},bt=x=>{const{current:q}=x;f(q),h()},kt=x=>{p(x.current),C()};return he(n,()=>{j.value=0,p(1),f(1),C()},{immediate:!0}),at(()=>{clearTimeout(g.value),clearTimeout(A.value),o(""),p(1),f(1)}),(x,q)=>{const ae=ke,Ue=ze,Be=lt,He=ts,Ve=it;return k(),U(le,null,[m("div",Oo,[m("div",Po,[m("div",Do,[m("div",{class:"to-chat",onClick:dt},[Fo,m("span",null,S(a(_).conversation),1)]),m("p",Lo,[m("span",To,S(a(s)),1),m("span",No,S(a(_).knowledgeID)+" "+S(a(n))+S(a(j)===1?"_FAQ":""),1)])]),m("div",Ro,[m("div",Eo,[(k(),U(le,null,Qe(te,Q=>m("div",{key:Q.name,class:Ht(["nav-item",a(j)===Q.value?"nav-item-active":""]),onClick:M=>Ct(Q.value)},S(Q.name),11,Mo)),64))]),a(j)===0?(k(),U("div",zo,[i(so,{"data-source":a(T)},null,8,["data-source"])])):X("",!0),m("div",jo,[a(j)===0?(k(),W(ae,{key:0,danger:"",class:"clear-upload",onClick:mt},{default:O(()=>[H(S(a(_).clearAllFile),1)]),_:1})):X("",!0),a(j)===0?(k(),W(ae,{key:1,class:"upload",onClick:pt},{default:O(()=>[H(S(a(_).upload),1)]),_:1})):X("",!0),a(j)===0?(k(),W(ae,{key:2,class:"add-link",onClick:gt},{default:O(()=>[H(S(a(_).addUrl),1)]),_:1})):X("",!0),a(j)===1?(k(),W(ae,{key:3,class:"upload",onClick:ft},{default:O(()=>[H(S(a(_).inputQa),1)]),_:1})):X("",!0)])]),m("div",Wo,[a(j)===0?(k(),W(Ve,{key:0,"data-source":a(T),columns:Ae,pagination:a(Ie),locale:{emptyText:a(_).emptyText},"hide-on-single-page":!0,"show-size-changer":!1,onChange:kt},{headerCell:O(({column:Q})=>[Q.key==="status"?(k(),U(le,{key:0},[m("span",null,S(a(_).documentStatus),1),i(Ue,{color:"#5a47e5"},{title:O(()=>[H(S(a(_).documentStatusNode),1)]),default:O(()=>[Uo]),_:1})],64)):X("",!0)]),bodyCell:O(({column:Q,record:M})=>[Q.key==="fileIdName"?(k(),W(Ue,{key:0,color:"#fff"},{title:O(()=>[m("span",Bo,S(M.fileIdName),1)]),default:O(()=>[m("span",null,S(M.fileIdName),1)]),_:2},1024)):Q.key==="status"?(k(),U("div",Ho,[m("span",Vo,[M.status==="gray"||M.status==="yellow"?(k(),W(tt,{key:0,class:"file-status"})):(k(),W(Be,{key:1,class:"file-status",name:M.status==="green"?"success":"error"},null,8,["name"]))]),m("span",null,S(vt(M.status)),1)])):Q.key==="remark"?(k(),U(le,{key:2},[typeof M.remark=="string"?(k(),U("div",qo,S(M.remark),1)):(k(),U("div",Qo,[(k(!0),U(le,null,Qe(M.remark,(ve,qe)=>(k(),U("p",{key:qe},S(`${qe}: ${ve}`),1))),128))]))],64)):Q.key==="options"?(k(),U(le,{key:3},[i(He,{"overlay-class-name":"del-pop",placement:"topRight",title:a(d).deleteTitle,"ok-text":a(d).confirm,"cancel-text":a(d).cancel,onConfirm:Oe},{default:O(()=>[i(ae,{type:"text",class:"delete-item",onClick:ve=>E(M)},{default:O(()=>[H(S(a(d).delete),1)]),_:2},1032,["onClick"])]),_:2},1032,["title","ok-text","cancel-text"]),i(ae,{type:"text",class:"view-item",disabled:M.status!=="green",onClick:ve=>me(M)},{default:O(()=>[H(S(a(d).view),1)]),_:2},1032,["disabled","onClick"])],64)):X("",!0)]),_:1},8,["data-source","pagination","locale"])):(k(),W(Ve,{key:1,"data-source":a(D),columns:$e,locale:{emptyText:a(_).emptyText},loading:a(ne),pagination:a(w),onChange:bt},{bodyCell:O(({column:Q,record:M})=>[Q.key==="status"?(k(),U("div",Zo,[m("span",Xo,[M.status==="gray"||M.status==="yellow"?(k(),W(tt,{key:0,class:"file-status"})):(k(),W(Be,{key:1,class:"file-status",name:M.status==="green"?"success":"error"},null,8,["name"]))]),m("span",null,S(ht(M.status)),1)])):Q.key==="options"?(k(),U("div",Go,[i(ae,{class:"edit-item",type:"link",disabled:M.status!=="green",onClick:ve=>pe(M)},{default:O(()=>[H(S(a(N).edit),1)]),_:2},1032,["disabled","onClick"]),i(He,{"overlay-class-name":"qa-del-pop",placement:"topRight",title:a(_).deleteQaSetText,"ok-text":a(d).confirm,"cancel-text":a(d).cancel,onConfirm:G},{default:O(()=>[i(ae,{class:"delete-item",danger:"",type:"link",onClick:ve=>se(M)},{default:O(()=>[H(S(a(d).delete),1)]),_:2},1032,["onClick"])]),_:2},1032,["title","ok-text","cancel-text"])])):X("",!0)]),_:1},8,["data-source","locale","loading","pagination"]))])])]),i(vo,{"kb-id":a(n),"file-id":a(J),"file-name":a(de)},null,8,["kb-id","file-id","file-name"]),i(Io,{"dialog-type":0})],64)}}}),vn=fe(Ko,[["__scopeId","data-v-abe4fe65"]]);export{mn as C,Io as F,tt as L,vn as O,fn as _,Ds as a,Rs as u};
