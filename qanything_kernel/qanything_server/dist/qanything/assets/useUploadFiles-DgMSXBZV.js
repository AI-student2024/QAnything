import{u as y,g as J,r as k,f as G,c as P}from"./utils-Ugh35qEN.js";import{a6 as Q,r as o,w as S,G as O,x as W}from"./index-CVjowkL6.js";import{g as K}from"./index-Ck4zvxVH.js";var X=(s=>(s[s.success=0]="success",s[s.parsed=1]="parsed",s[s.error=2]="error",s[s.filebig=3]="filebig",s[s.loading=4]="loading",s[s.failed=5]="failed",s))(X||{}),E=(s=>(s[s.initing=0]="initing",s[s.default=1]="default",s[s.normal=2]="normal",s[s.optionlist=3]="optionlist",s))(E||{});const _=K().common,$=Q("knowledgeBase",()=>{const s=o(""),A=l=>{s.value=l};S(()=>s.value,()=>{console.log("current",s.value)});const n=o(""),h=l=>{n.value=l},i=o([]),U=l=>{i.value=l},p=o(""),L=l=>{p.value=l},r=o([]),f=l=>{r.value=l},v=o(E.initing),b=l=>{v.value=l},B=o(!1);return{currentId:s,newKbId:n,setNewKbId:h,setCurrentId:A,knowledgeBaseList:r,setKnowledgeBaseList:f,showDeleteModal:B,setShowDeleteModal:l=>{B.value=l},showDefault:v,setDefault:b,getList:async()=>{var l,u;try{const d=await y.kbList();if(+d.code==200)if(((l=d==null?void 0:d.data)==null?void 0:l.length)>0){const I=d.data.filter(N=>!/.*_FAQ$/.test(N.kb_name));f(I),b(E.normal),i.value.length||i.value.push((u=I[0])==null?void 0:u.kb_id)}else f([]),b(E.default);console.log(r.value)}catch(d){O.error(d.msg||_.error)}},currentKbName:p,setCurrentKbName:L,selectList:i,setSelectList:U}},{persist:{storage:localStorage}}),Y=K().home,ee=K().common,oe=Q("knowledgeModal",()=>{const s=o(!1),A=c=>{s.value=c},n=o(!1),h=c=>{n.value=c},i=o(Y.upload),U=c=>{i.value=c},p=o(""),L=c=>{p.value=c},r=o([]),f=c=>{r.value=c},v=o([]);return{modalVisible:s,setModalVisible:A,urlModalVisible:n,setUrlModalVisible:h,knowledgeName:p,setKnowledgeName:L,fileList:r,setFileList:f,urlList:v,setUrlList:c=>{v.value=c},modalTitle:i,setModalTitle:U,$reset:()=>{s.value=!1,i.value=Y.upload,p.value="",r.value=[],v.value=[]},getFileList:async c=>{try{const l=await y.fileList({kb_id:c});l.code==200&&(l.data.details.forEach(u=>{u.errorText=J(u)}),f(l.data.details))}catch(l){console.log(l),O.error(l.msg||ee.error)}}}}),{currentId:M}=W($()),le=Q("option-list",()=>{const s=o([]),A=e=>{s.value=e},n=o({green:0,gray:0,yellow:0,red:0}),h=o(0),i=e=>{h.value=e},U=o(1),p=e=>{U.value=e},L=o(10),r=o([]),f=e=>{r.value=e},v=o(0),b=e=>{v.value=e},B=o(1),T=e=>{B.value=e},c=o(10),l=o(!1),u=e=>{l.value=e},d=o("upload"),I=e=>{d.value=e},N=o(null),R=e=>{N.value=e},x=o(!1),Z=e=>{x.value=e},F=o(null),z=async()=>{F.value&&clearTimeout(F.value);const e=await k(await y.fileList({kb_id:M.value,page_id:U.value,page_limit:L.value}));Object.keys(n.value).forEach(t=>{n.value[t]=0}),Object.assign(n.value,e.status_count),A([]),i(e.total);const C=(t="",g="green")=>g!=="green"?t:JSON.parse(t.toString());e==null||e.details.forEach((t,g)=>{s.value.push({id:1e4+g,fileId:t==null?void 0:t.file_id,fileIdName:t==null?void 0:t.file_name,status:t==null?void 0:t.status,bytes:G((t==null?void 0:t.bytes)||0),createtime:P(t==null?void 0:t.timestamp),remark:(t==null?void 0:t.status)==="gray"?"":C(t==null?void 0:t.msg,t==null?void 0:t.status)})}),(e==null?void 0:e.details.some(t=>t.status==="gray"||t.status==="yellow"))?F.value=setTimeout(()=>{clearTimeout(F.value),z()},5e3):q()},q=()=>{let e=null;e=setInterval(async()=>{const C=await k(await y.fileList({kb_id:M.value,page_id:1,page_limit:L.value}));Object.keys(n.value).forEach(a=>{n.value[a]=0}),Object.assign(n.value,C.status_count),i(C.total),n.value.gray===0&&n.value.yellow===0&&clearInterval(e)},5e3)},m=o(null),V=async()=>{try{m.value&&clearTimeout(m.value),u(!0);const e=await k(await y.fileList({kb_id:M.value+"_FAQ",page_id:B.value,page_limit:c.value}));if(f([]),e!=null&&e.details)b(e.total);else{b(0),u(!1);return}for(const a of e==null?void 0:e.details){const t=e==null?void 0:e.details.indexOf(a);r.value.push({id:1e4+t,faqId:a==null?void 0:a.file_id,question:a==null?void 0:a.question,answer:a==null?void 0:a.answer,status:a==null?void 0:a.status,bytes:`${a==null?void 0:a.content_length}字符`,createtime:P(a==null?void 0:a.timestamp),picUrlList:[]}),a!=null&&a.picUrlList&&await H(a==null?void 0:a.picUrlList).then(g=>{console.log("成功获取图片文件:",g),r.value[t].picUrlList=a==null?void 0:a.picUrlList.map((w,D)=>({uid:-D,name:"image",status:"done",url:w,originFileObj:g[D]}))}).catch(g=>{console.error("获取图片文件出错:",g)})}(e==null?void 0:e.details.some(a=>a.status==="gray"||a.status==="yellow"))?(console.log("有解析中的  5s后再次请求"),m.value=setTimeout(()=>{clearTimeout(m.value),V()},5e3)):console.log("全部解析完成")}catch(e){console.log(e),O.error(e.msg||"获取faq列表失败")}u(!1)};function H(e){const C=e.map(a=>new Promise((t,g)=>{fetch(a).then(w=>w.blob()).then(w=>{const D=a.substring(a.lastIndexOf("/")+1),j=new File([w],D,{type:w.type});t(j)}).catch(w=>{console.error("Error fetching the image:",w),g(w)})}));return Promise.all(C)}return{dataSource:s,setDataSource:A,faqList:r,setFaqList:f,getDetails:z,timer:F,editQaSet:N,setEditQaSet:R,editModalVisible:x,setEditModalVisible:Z,faqTimer:m,getFaqList:V,faqType:d,setFaqType:I,total:v,pageSize:c,setTotal:b,pageNum:B,setPageNum:T,loading:l,setLoading:u,totalStatus:n,kbTotal:h,kbPageSize:L,kbPageNum:U,setKbPageNum:p}},{persist:{storage:sessionStorage}}),ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",ce=Q("useUploadFiles",()=>{const s=o([]),A=()=>{s.value=[]},n=o([]);return{uploadFileList:s,initUploadFileList:A,uploadFileListQuick:n,initUploadFileListQuick:()=>{n.value=[]}}});export{ne as _,oe as a,le as b,ce as c,X as f,E as p,$ as u};
