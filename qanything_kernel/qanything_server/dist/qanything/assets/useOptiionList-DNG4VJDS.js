import{u as N,g as H,r as O,f as j,c as K}from"./utils-nP-Zc0kd.js";import{x as E,r as t,R as D,z as J}from"./index-CAMuaXOT.js";import{g as T}from"./index-DaUCtD7D.js";var G=(o=>(o[o.success=0]="success",o[o.parsed=1]="parsed",o[o.error=2]="error",o[o.filebig=3]="filebig",o[o.loading=4]="loading",o[o.failed=5]="failed",o))(G||{}),F=(o=>(o[o.initing=0]="initing",o[o.default=1]="default",o[o.normal=2]="normal",o[o.optionlist=3]="optionlist",o))(F||{});const W=T().common,S=E("knowledgeBase",()=>{const o=t(""),b=l=>{o.value=l},c=t([]),B=l=>{c.value=l},d=t(""),f=l=>{d.value=l},A=t([]),w=l=>{A.value=l},r=t(F.initing),u=l=>{r.value=l},i=t(!1);return{currentId:o,setCurrentId:b,knowledgeBaseList:A,setKnowledgeBaseList:w,showDeleteModal:i,setShowDeleteModal:l=>{i.value=l},showDefault:r,setDefault:u,getList:async()=>{var l;try{const a=await N.kbList();if(+a.code==200)if(((l=a==null?void 0:a.data)==null?void 0:l.length)>0){const n=a.data.filter(v=>!/.*_FAQ$/.test(v.kb_name));w(n),u(F.normal),c.value.length||c.value.push(n[0].kb_id)}else u(F.default)}catch(a){D.error(a.msg||W.error)}},currentKbName:d,setCurrentKbName:f,selectList:c,setSelectList:B}}),V=T().home,X=T().common,se=E("knowledgeModal",()=>{const o=t(!1),b=a=>{o.value=a},c=t(!1),B=a=>{c.value=a},d=t(V.upload),f=a=>{d.value=a},A=t(""),w=a=>{A.value=a},r=t([]),u=a=>{r.value=a},i=t([]);return{modalVisible:o,setModalVisible:b,urlModalVisible:c,setUrlModalVisible:B,knowledgeName:A,setKnowledgeName:w,fileList:r,setFileList:u,urlList:i,setUrlList:a=>{i.value=a},modalTitle:d,setModalTitle:f,$reset:()=>{o.value=!1,d.value=V.upload,A.value="",r.value=[],i.value=[]},getFileList:async a=>{try{const n=await N.fileList({kb_id:a});n.code==200&&(n.data.details.forEach(v=>{v.errorText=H(v)}),u(n.data.details))}catch(n){console.log(n),D.error(n.msg||X.error)}}}}),oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",{currentId:Y}=J(S()),te=E("option-list",()=>{const o=t([]),b=s=>{o.value=s},c=t({green:0,gray:0,yellow:0,red:0}),B=t(0),d=s=>{B.value=s},f=t(1),A=s=>{f.value=s},w=t(10),r=t([]),u=s=>{r.value=s},i=t(0),y=s=>{i.value=s},m=t(1),l=s=>{m.value=s},a=t(!1),n=s=>{a.value=s},v=t("upload"),P=s=>{v.value=s},M=t(null),R=s=>{M.value=s},x=t(!1),Z=s=>{x.value=s},p=t(null),Q=async()=>{try{p.value&&clearTimeout(p.value),console.log(f.value);const s=await O(await N.fileList({kb_id:Y.value,page_offset:f.value,page_limit:w.value}));Object.keys(c.value).forEach(e=>{c.value[e]=0}),Object.assign(c.value,s.status_count),console.log("----",c.value),b([]),d(s.total),s==null||s.details.forEach((e,C)=>{o.value.push({id:1e4+C,fileId:e==null?void 0:e.file_id,fileIdName:e==null?void 0:e.file_name,status:e==null?void 0:e.status,bytes:j((e==null?void 0:e.bytes)||0),createtime:K(e==null?void 0:e.timestamp),errortext:(e==null?void 0:e.status)==="gray"||(e==null?void 0:e.status)==="green"?"":e==null?void 0:e.msg})});const h=s==null?void 0:s.details.some(e=>e.status==="gray"||e.status==="yellow");console.log(h),h?(console.log("有解析中的  5后再次请求"),p.value=setTimeout(()=>{clearTimeout(p.value),Q()},5e3)):console.log("全部解析完成")}catch(s){console.log(s),D.error(s.msg||"获取知识库详情失败")}},L=t(null),z=async()=>{try{L.value&&clearTimeout(L.value),n(!0);const s=await O(await N.fileList({kb_id:Y.value+"_FAQ"}));if(u([]),!(s!=null&&s.details)){y(0),n(!1);return}for(const e of s==null?void 0:s.details){const C=s==null?void 0:s.details.indexOf(e);r.value.push({id:1e4+C,faqId:e==null?void 0:e.file_id,question:e==null?void 0:e.question,answer:e==null?void 0:e.answer,status:e==null?void 0:e.status,bytes:`${e==null?void 0:e.content_length}字符`,createtime:K(e==null?void 0:e.timestamp),picUrlList:[]}),e!=null&&e.picUrlList&&await k(e==null?void 0:e.picUrlList).then(U=>{console.log("成功获取图片文件:",U),r.value[C].picUrlList=e==null?void 0:e.picUrlList.map((g,I)=>({uid:-I,name:"image",status:"done",url:g,originFileObj:U[I]}))}).catch(U=>{console.error("获取图片文件出错:",U)})}const h=s==null?void 0:s.details.some(e=>e.status==="gray"||e.status==="yellow");console.log("flag",h),h?(console.log("有解析中的  5s后再次请求"),L.value=setTimeout(()=>{clearTimeout(L.value),z()},5e3)):console.log("全部解析完成")}catch(s){console.log(s),D.error(s.msg||"获取faq列表失败")}n(!1)};function k(s){const h=s.map(e=>new Promise((C,U)=>{fetch(e).then(g=>g.blob()).then(g=>{const I=e.substring(e.lastIndexOf("/")+1),q=new File([g],I,{type:g.type});C(q)}).catch(g=>{console.error("Error fetching the image:",g),U(g)})}));return Promise.all(h)}return{dataSource:o,setDataSource:b,faqList:r,setFaqList:u,getDetails:Q,timer:p,editQaSet:M,setEditQaSet:R,editModalVisible:x,setEditModalVisible:Z,faqTimer:L,getFaqList:z,faqType:v,setFaqType:P,total:i,setTotal:y,pageNum:m,setPageNum:l,loading:a,setLoading:n,totalStatus:c,kbTotal:B,kbPageSize:w,kbPageNum:f,setKbPageNum:A}},{persist:{storage:sessionStorage}});export{oe as _,se as a,te as b,G as f,F as p,S as u};
