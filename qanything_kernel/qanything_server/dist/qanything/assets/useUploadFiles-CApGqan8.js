import{u as e,g as a,r as t,f as l,c as i}from"./utils-kifUDenk.js";import{a4 as s,r as o,w as u,J as n,y as r}from"./index-BbMN_vfI.js";import{g as d}from"./index-AGU1Aiar.js";var v=(e=>(e[e.success=0]="success",e[e.parsed=1]="parsed",e[e.error=2]="error",e[e.filebig=3]="filebig",e[e.loading=4]="loading",e[e.failed=5]="failed",e))(v||{}),c=(e=>(e[e.initing=0]="initing",e[e.default=1]="default",e[e.normal=2]="normal",e[e.optionlist=3]="optionlist",e))(c||{});const g=d().common,m=s("knowledgeBase",(()=>{const a=o("");u((()=>a.value),(()=>{}));const t=o([]),l=o(""),i=o([]),s=e=>{i.value=e},r=o(c.initing),d=e=>{r.value=e},v=o(!1);return{currentId:a,setCurrentId:e=>{a.value=e},knowledgeBaseList:i,setKnowledgeBaseList:s,showDeleteModal:v,setShowDeleteModal:e=>{v.value=e},showDefault:r,setDefault:d,getList:async()=>{var a,l;try{const i=await e.kbList();if(200==+i.code)if((null==(a=null==i?void 0:i.data)?void 0:a.length)>0){const e=i.data.filter((e=>!/.*_FAQ$/.test(e.kb_name)));s(e),d(c.normal),t.value.length||t.value.push(null==(l=e[0])?void 0:l.kb_id)}else s([]),d(c.default)}catch(i){n.error(i.msg||g.error)}},currentKbName:l,setCurrentKbName:e=>{l.value=e},selectList:t,setSelectList:e=>{t.value=e}}}),{persist:{storage:localStorage}}),A=d().home,f=d().common,w=s("knowledgeModal",(()=>{const t=o(!1),l=o(!1),i=o(A.upload),s=o(""),u=o([]),r=e=>{u.value=e},d=o([]);return{modalVisible:t,setModalVisible:e=>{t.value=e},urlModalVisible:l,setUrlModalVisible:e=>{l.value=e},knowledgeName:s,setKnowledgeName:e=>{s.value=e},fileList:u,setFileList:r,urlList:d,setUrlList:e=>{d.value=e},modalTitle:i,setModalTitle:e=>{i.value=e},$reset:()=>{t.value=!1,i.value=A.upload,s.value="",u.value=[],d.value=[]},getFileList:async t=>{try{const l=await e.fileList({kb_id:t});200==l.code&&(l.data.details.forEach((e=>{e.errorText=a(e)})),r(l.data.details))}catch(l){n.error(l.msg||f.error)}}}})),{currentId:p}=r(m()),b=s("option-list",(()=>{const a=o([]),s=e=>{a.value=e},u=o({green:0,gray:0,yellow:0,red:0}),r=o(0),d=e=>{r.value=e},v=o(1),c=o(10),g=o([]),m=e=>{g.value=e},A=o(0),f=e=>{A.value=e},w=o(1),b=o(10),h=o(!1),U=e=>{h.value=e},B=o("upload"),C=o(null),y=o(!1),L=o(null),F=async()=>{L.value&&clearTimeout(L.value);const o=await t(await e.fileList({kb_id:p.value,page_id:v.value,page_limit:c.value}));Object.keys(u.value).forEach((e=>{u.value[e]=0})),Object.assign(u.value,o.status_count),s([]),d(o.total);const n=(e="",a="green")=>"green"!==a?e:JSON.parse(e.toString());null==o||o.details.forEach(((e,t)=>{a.value.push({id:1e4+t,fileId:null==e?void 0:e.file_id,fileIdName:null==e?void 0:e.file_name,status:null==e?void 0:e.status,bytes:l((null==e?void 0:e.bytes)||0),contentLength:null==e?void 0:e.content_length,createtime:i(null==e?void 0:e.timestamp),remark:"gray"===(null==e?void 0:e.status)?"":n(null==e?void 0:e.msg,null==e?void 0:e.status)})}));(null==o?void 0:o.details.some((e=>"gray"===e.status||"yellow"===e.status)))?L.value=setTimeout((()=>{clearTimeout(L.value),F()}),5e3):I()},I=()=>{let a=null;a=setInterval((async()=>{const l=await t(await e.fileList({kb_id:p.value,page_id:1,page_limit:c.value}));Object.keys(u.value).forEach((e=>{u.value[e]=0})),Object.assign(u.value,l.status_count),d(l.total),0===u.value.gray&&0===u.value.yellow&&clearInterval(a)}),5e3)},N=o(null),S=async()=>{try{N.value&&clearTimeout(N.value),U(!0);const a=await t(await e.fileList({kb_id:p.value+"_FAQ",page_id:w.value,page_limit:b.value}));if(m([]),!(null==a?void 0:a.details))return f(0),void U(!1);f(a.total);for(const e of null==a?void 0:a.details){const t=null==a?void 0:a.details.indexOf(e);g.value.push({id:1e4+t,faqId:null==e?void 0:e.file_id,question:null==e?void 0:e.question,answer:null==e?void 0:e.answer,status:null==e?void 0:e.status,bytes:`${null==e?void 0:e.content_length}字符`,createtime:i(null==e?void 0:e.timestamp),picUrlList:[]}),(null==e?void 0:e.picUrlList)&&await E(null==e?void 0:e.picUrlList).then((a=>{g.value[t].picUrlList=null==e?void 0:e.picUrlList.map(((e,t)=>({uid:-t,name:"image",status:"done",url:e,originFileObj:a[t]})))})).catch((e=>{}))}(null==a?void 0:a.details.some((e=>"gray"===e.status||"yellow"===e.status)))&&(N.value=setTimeout((()=>{clearTimeout(N.value),S()}),5e3))}catch(a){n.error(a.msg||"获取faq列表失败")}U(!1)};function E(e){const a=e.map((e=>new Promise(((a,t)=>{fetch(e).then((e=>e.blob())).then((t=>{const l=e.substring(e.lastIndexOf("/")+1),i=new File([t],l,{type:t.type});a(i)})).catch((e=>{t(e)}))}))));return Promise.all(a)}return{dataSource:a,setDataSource:s,faqList:g,setFaqList:m,getDetails:F,timer:L,editQaSet:C,setEditQaSet:e=>{C.value=e},editModalVisible:y,setEditModalVisible:e=>{y.value=e},faqTimer:N,getFaqList:S,faqType:B,setFaqType:e=>{B.value=e},total:A,pageSize:b,setTotal:f,pageNum:w,setPageNum:e=>{w.value=e},loading:h,setLoading:U,totalStatus:u,kbTotal:r,kbPageSize:c,kbPageNum:v,setKbPageNum:e=>{v.value=e}}}),{persist:{storage:sessionStorage}}),h="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",U=s("useUploadFiles",(()=>{const e=o([]),a=o([]);return{uploadFileList:e,initUploadFileList:()=>{e.value=[]},uploadFileListQuick:a,initUploadFileListQuick:()=>{a.value=[]}}}));export{h as _,w as a,b,U as c,v as f,c as p,m as u};
