import{u as F,g as H,r as O,f as j,c as K}from"./utils-QvmHLhCR.js";import{x as D,r as o,R as I,z as J,N as _,A as G,B as W,aR as S}from"./index-BmCpu3aX.js";import{g as T}from"./index-BuoR8LFG.js";const re=t=>!isNaN(parseFloat(t))&&isFinite(t);var X=(t=>(t[t.success=0]="success",t[t.parsed=1]="parsed",t[t.error=2]="error",t[t.filebig=3]="filebig",t[t.loading=4]="loading",t[t.failed=5]="failed",t))(X||{}),y=(t=>(t[t.initing=0]="initing",t[t.default=1]="default",t[t.normal=2]="normal",t[t.optionlist=3]="optionlist",t))(y||{});const $=T().common,ee=D("knowledgeBase",()=>{const t=o(""),A=l=>{t.value=l},c=o([]),b=l=>{c.value=l},g=o(""),w=l=>{g.value=l},f=o([]),v=l=>{f.value=l},r=o(y.default),i=l=>{r.value=l},u=o(!1);return{currentId:t,setCurrentId:A,knowledgeBaseList:f,setKnowledgeBaseList:v,showDeleteModal:u,setShowDeleteModal:l=>{u.value=l},showDefault:r,setDefault:i,getList:async()=>{var l;try{const a=await F.kbList();if(+a.code==200)if(((l=a==null?void 0:a.data)==null?void 0:l.length)>0){const n=a.data.filter(h=>!/.*_FAQ$/.test(h.kb_name));v(n),i(y.normal),c.value.length||c.value.push(n[0].kb_id)}else i(y.default)}catch(a){I.error(a.msg||$.error)}},currentKbName:g,setCurrentKbName:w,selectList:c,setSelectList:b}}),V=T().home,se=T().common,ie=D("knowledgeModal",()=>{const t=o(!1),A=a=>{t.value=a},c=o(!1),b=a=>{c.value=a},g=o(V.upload),w=a=>{g.value=a},f=o(""),v=a=>{f.value=a},r=o([]),i=a=>{r.value=a},u=o([]);return{modalVisible:t,setModalVisible:A,urlModalVisible:c,setUrlModalVisible:b,knowledgeName:f,setKnowledgeName:v,fileList:r,setFileList:i,urlList:u,setUrlList:a=>{u.value=a},modalTitle:g,setModalTitle:w,$reset:()=>{t.value=!1,g.value=V.upload,f.value="",r.value=[],u.value=[]},getFileList:async a=>{try{const n=await F.fileList({kb_id:a});n.code==200&&(n.data.details.forEach(h=>{h.errorText=H(h)}),i(n.data.details))}catch(n){console.log(n),I.error(n.msg||se.error)}}}}),{currentId:k}=J(ee()),ue=D("option-list",()=>{const t=o([]),A=s=>{t.value=s},c=o({green:0,gray:0,yellow:0,red:0}),b=o(0),g=s=>{b.value=s},w=o(1),f=s=>{w.value=s},v=o(10),r=o([]),i=s=>{r.value=s},u=o(0),C=s=>{u.value=s},L=o(1),l=s=>{L.value=s},a=o(!1),n=s=>{a.value=s},h=o("upload"),R=s=>{h.value=s},M=o(null),Y=s=>{M.value=s},x=o(!1),P=s=>{x.value=s},m=o(null),Q=async()=>{try{m.value&&clearTimeout(m.value);const s=await O(await F.fileList({kb_id:k.value,page_offset:w.value,page_limit:v.value}));Object.keys(c.value).forEach(e=>{c.value[e]=0}),Object.assign(c.value,s.status_count),A([]),g(s.total),s==null||s.details.forEach((e,B)=>{t.value.push({id:1e4+B,fileId:e==null?void 0:e.file_id,fileIdName:e==null?void 0:e.file_name,status:e==null?void 0:e.status,bytes:j((e==null?void 0:e.bytes)||0),createtime:K(e==null?void 0:e.timestamp),errortext:(e==null?void 0:e.status)==="gray"?"":e==null?void 0:e.msg})}),(s==null?void 0:s.details.some(e=>e.status==="gray"||e.status==="yellow"))?(console.log("有解析中的  5后再次请求"),m.value=setTimeout(()=>{clearTimeout(m.value),Q()},5e3)):console.log("全部解析完成")}catch(s){I.error(s.msg||"获取知识库详情失败")}},U=o(null),z=async()=>{try{U.value&&clearTimeout(U.value),n(!0);const s=await O(await F.fileList({kb_id:k.value+"_FAQ"}));if(i([]),!(s!=null&&s.details)){C(0),n(!1);return}for(const e of s==null?void 0:s.details){const B=s==null?void 0:s.details.indexOf(e);r.value.push({id:1e4+B,faqId:e==null?void 0:e.file_id,question:e==null?void 0:e.question,answer:e==null?void 0:e.answer,status:e==null?void 0:e.status,bytes:`${e==null?void 0:e.content_length}字符`,createtime:K(e==null?void 0:e.timestamp),picUrlList:[]}),e!=null&&e.picUrlList&&await Z(e==null?void 0:e.picUrlList).then(p=>{console.log("成功获取图片文件:",p),r.value[B].picUrlList=e==null?void 0:e.picUrlList.map((d,N)=>({uid:-N,name:"image",status:"done",url:d,originFileObj:p[N]}))}).catch(p=>{console.error("获取图片文件出错:",p)})}(s==null?void 0:s.details.some(e=>e.status==="gray"||e.status==="yellow"))?(console.log("有解析中的  5s后再次请求"),U.value=setTimeout(()=>{clearTimeout(U.value),z()},5e3)):console.log("全部解析完成")}catch(s){console.log(s),I.error(s.msg||"获取faq列表失败")}n(!1)};function Z(s){const E=s.map(e=>new Promise((B,p)=>{fetch(e).then(d=>d.blob()).then(d=>{const N=e.substring(e.lastIndexOf("/")+1),q=new File([d],N,{type:d.type});B(q)}).catch(d=>{console.error("Error fetching the image:",d),p(d)})}));return Promise.all(E)}return{dataSource:t,setDataSource:A,faqList:r,setFaqList:i,getDetails:Q,timer:m,editQaSet:M,setEditQaSet:Y,editModalVisible:x,setEditModalVisible:P,faqTimer:U,getFaqList:z,faqType:h,setFaqType:R,total:u,setTotal:C,pageNum:L,setPageNum:l,loading:a,setLoading:n,totalStatus:c,kbTotal:b,kbPageSize:v,kbPageNum:w,setKbPageNum:f}},{persist:{storage:sessionStorage}}),te={},oe={class:""};function ae(t,A){return G(),W("div",oe,[S(t.$slots,"default",{},void 0,!0)])}const de=_(te,[["render",ae],["__scopeId","data-v-629ddaa7"]]),ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC";export{de as U,ge as _,ie as a,ue as b,X as f,re as i,y as p,ee as u};
