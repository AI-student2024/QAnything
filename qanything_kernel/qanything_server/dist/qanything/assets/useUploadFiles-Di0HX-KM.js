import{u as y,g as J,r as k,f as S,c as P}from"./utils-DIK0xSrc.js";import{x as Q,r as o,w as G,Q as O,z as W}from"./index-BuoTN8pR.js";import{g as z}from"./index-BlgH1fUl.js";var X=(s=>(s[s.success=0]="success",s[s.parsed=1]="parsed",s[s.error=2]="error",s[s.filebig=3]="filebig",s[s.loading=4]="loading",s[s.failed=5]="failed",s))(X||{}),E=(s=>(s[s.initing=0]="initing",s[s.default=1]="default",s[s.normal=2]="normal",s[s.optionlist=3]="optionlist",s))(E||{});const _=z().common,$=Q("knowledgeBase",()=>{const s=o(""),w=l=>{s.value=l};G(()=>s.value,()=>{console.log("current",s.value)});const n=o(""),h=l=>{n.value=l},r=o([]),U=l=>{r.value=l},A=o(""),L=l=>{A.value=l},i=o([]),p=l=>{i.value=l},f=o(E.initing),b=l=>{f.value=l},B=o(!1);return{currentId:s,newKbId:n,setNewKbId:h,setCurrentId:w,knowledgeBaseList:i,setKnowledgeBaseList:p,showDeleteModal:B,setShowDeleteModal:l=>{B.value=l},showDefault:f,setDefault:b,getList:async()=>{var l,u;try{const d=await y.kbList();if(+d.code==200)if(((l=d==null?void 0:d.data)==null?void 0:l.length)>0){const I=d.data.filter(N=>!/.*_FAQ$/.test(N.kb_name));p(I),b(E.normal),r.value.length||r.value.push((u=I[0])==null?void 0:u.kb_id)}else b(E.default)}catch(d){O.error(d.msg||_.error)}},currentKbName:A,setCurrentKbName:L,selectList:r,setSelectList:U}},{persist:{storage:localStorage}}),Y=z().home,ee=z().common,oe=Q("knowledgeModal",()=>{const s=o(!1),w=c=>{s.value=c},n=o(!1),h=c=>{n.value=c},r=o(Y.upload),U=c=>{r.value=c},A=o(""),L=c=>{A.value=c},i=o([]),p=c=>{i.value=c},f=o([]);return{modalVisible:s,setModalVisible:w,urlModalVisible:n,setUrlModalVisible:h,knowledgeName:A,setKnowledgeName:L,fileList:i,setFileList:p,urlList:f,setUrlList:c=>{f.value=c},modalTitle:r,setModalTitle:U,$reset:()=>{s.value=!1,r.value=Y.upload,A.value="",i.value=[],f.value=[]},getFileList:async c=>{try{const l=await y.fileList({kb_id:c});l.code==200&&(l.data.details.forEach(u=>{u.errorText=J(u)}),p(l.data.details))}catch(l){console.log(l),O.error(l.msg||ee.error)}}}}),{currentId:M}=W($()),le=Q("option-list",()=>{const s=o([]),w=e=>{s.value=e},n=o({green:0,gray:0,yellow:0,red:0}),h=o(0),r=e=>{h.value=e},U=o(1),A=e=>{U.value=e},L=o(10),i=o([]),p=e=>{i.value=e},f=o(0),b=e=>{f.value=e},B=o(1),T=e=>{B.value=e},c=o(10),l=o(!1),u=e=>{l.value=e},d=o("upload"),I=e=>{d.value=e},N=o(null),R=e=>{N.value=e},K=o(!1),Z=e=>{K.value=e},F=o(null),x=async()=>{F.value&&clearTimeout(F.value);const e=await k(await y.fileList({kb_id:M.value,page_offset:U.value,page_limit:L.value}));Object.keys(n.value).forEach(a=>{n.value[a]=0}),Object.assign(n.value,e.status_count),w([]),r(e.total);const C=(a="",g="green")=>g!=="green"?a:JSON.parse(a.toString());e==null||e.details.forEach((a,g)=>{s.value.push({id:1e4+g,fileId:a==null?void 0:a.file_id,fileIdName:a==null?void 0:a.file_name,status:a==null?void 0:a.status,bytes:S((a==null?void 0:a.bytes)||0),createtime:P(a==null?void 0:a.timestamp),remark:(a==null?void 0:a.status)==="gray"?"":C(a==null?void 0:a.msg,a==null?void 0:a.status)})}),(e==null?void 0:e.details.some(a=>a.status==="gray"||a.status==="yellow"))?F.value=setTimeout(()=>{clearTimeout(F.value),x()},5e3):q()},q=()=>{let e=null;e=setInterval(async()=>{const C=await k(await y.fileList({kb_id:M.value,page_offset:1,page_limit:L.value}));Object.keys(n.value).forEach(t=>{n.value[t]=0}),Object.assign(n.value,C.status_count),r(C.total),n.value.gray===0&&n.value.yellow===0&&clearInterval(e)},5e3)},m=o(null),V=async()=>{try{m.value&&clearTimeout(m.value),u(!0);const e=await k(await y.fileList({kb_id:M.value+"_FAQ",page_offset:B.value,page_limit:c.value}));if(p([]),e!=null&&e.details)b(e.total);else{b(0),u(!1);return}for(const t of e==null?void 0:e.details){const a=e==null?void 0:e.details.indexOf(t);i.value.push({id:1e4+a,faqId:t==null?void 0:t.file_id,question:t==null?void 0:t.question,answer:t==null?void 0:t.answer,status:t==null?void 0:t.status,bytes:`${t==null?void 0:t.content_length}字符`,createtime:P(t==null?void 0:t.timestamp),picUrlList:[]}),t!=null&&t.picUrlList&&await H(t==null?void 0:t.picUrlList).then(g=>{console.log("成功获取图片文件:",g),i.value[a].picUrlList=t==null?void 0:t.picUrlList.map((v,D)=>({uid:-D,name:"image",status:"done",url:v,originFileObj:g[D]}))}).catch(g=>{console.error("获取图片文件出错:",g)})}(e==null?void 0:e.details.some(t=>t.status==="gray"||t.status==="yellow"))?(console.log("有解析中的  5s后再次请求"),m.value=setTimeout(()=>{clearTimeout(m.value),V()},5e3)):console.log("全部解析完成")}catch(e){console.log(e),O.error(e.msg||"获取faq列表失败")}u(!1)};function H(e){const C=e.map(t=>new Promise((a,g)=>{fetch(t).then(v=>v.blob()).then(v=>{const D=t.substring(t.lastIndexOf("/")+1),j=new File([v],D,{type:v.type});a(j)}).catch(v=>{console.error("Error fetching the image:",v),g(v)})}));return Promise.all(C)}return{dataSource:s,setDataSource:w,faqList:i,setFaqList:p,getDetails:x,timer:F,editQaSet:N,setEditQaSet:R,editModalVisible:K,setEditModalVisible:Z,faqTimer:m,getFaqList:V,faqType:d,setFaqType:I,total:f,pageSize:c,setTotal:b,pageNum:B,setPageNum:T,loading:l,setLoading:u,totalStatus:n,kbTotal:h,kbPageSize:L,kbPageNum:U,setKbPageNum:A}},{persist:{storage:sessionStorage}}),ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",ce=Q("useUploadFiles",()=>{const s=o([]),w=()=>{s.value=[]},n=o([]);return{uploadFileList:s,initUploadFileList:w,uploadFileListQuick:n,initUploadFileListQuick:()=>{n.value=[]}}});export{ne as _,oe as a,le as b,ce as c,X as f,E as p,$ as u};
